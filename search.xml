<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>PAXOS</title>
      <link href="/zookeeper/paxos/"/>
      <url>/zookeeper/paxos/</url>
      
        <content type="html"><![CDATA[<h1 id="Paxos-算法浅析"><a href="#Paxos-算法浅析" class="headerlink" title="Paxos 算法浅析"></a>Paxos 算法浅析</h1><p>本文基于 <a href="https://zh.wikipedia.org/wiki/Paxos%E7%AE%97%E6%B3%95" target="_blank" rel="noopener">Wiki Paxos 算法</a> 成文</p><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>Paxos 算法由 Lamport 大神于 1990 年提出的一种基于消息传递且具有高度容错特性的共识算法。</p><p>Mike Burrows(Google Chubby 作者)曾说过：</p><blockquote><p>there is only one consensus protocol, and that’s Paxos</p></blockquote><p>我们知道，在分布式系统中，节点通信分为两种模型</p><ul><li>共享内存</li><li>消息传递</li></ul><p>基于消息传递模型的分布式系统，必然需要考虑如下问题</p><ul><li>消息丢失</li><li>消息重复</li><li>消息延迟</li><li>…</li></ul><p>在不考虑拜占庭错误的情况下，Paxos 算法解决的问题就是</p><blockquote><p>在一个可能发生上述异常的分布式场景中，如何就某一个值达成一致，</p><p>保证不论发生以上任何异常，都不会破坏决议的共识。</p><p>如在一个分布式数据库系统中，若各节点初始状态一致，每个节点都执行相同的</p><p>操作序列，那么最后能得到一个一致的状态。</p><p>为保证每个节点执行相同的命令序列，需要在每一条指令上执行一个“共识算法”</p><p> –  <a href="https://zh.wikipedia.org/wiki/Paxos算法" target="_blank" rel="noopener">WIKI Paxos 算法</a></p></blockquote><h2 id="角色"><a href="#角色" class="headerlink" title="角色"></a>角色</h2><p>在 Paxos 算法中，角色：</p><ul><li>proposer : 负责提出提案，相当于 zk 中的 leader</li><li>acceptor： 负责接受提案，相当于 zk 中的 follower</li><li>learner：负责学习提案，相当于 zk 中的 learner</li></ul><p>在具体的实现中，一个进程可能不止充当一种角色</p><p>本文中使用的名词：</p><ul><li><p>quorum： 超过半数的 acceptor 组成的集合(最早称之为 majority，这里直接使用 quorun)</p></li><li><p>proposal： 提案，由 proposal 提出，包含编号和值： proposal(n,v)</p></li><li><p>value：决议，被批准的提案，同样包括编号和值：value(n,v)</p></li></ul><h2 id="基准约束"><a href="#基准约束" class="headerlink" title="基准约束"></a>基准约束</h2><p>首先由 proposer 提出 proposal(n,v)，acceptor 接到提案后，可以选择接受提案，当该 proposal 获得了 quorum (大多数 acceptor)的支持后，则该 proposal 被批准(chosen)，成为 value，由 learner 进行学习。</p><p>那么， Paxos 要解决的问题可以归纳为：</p><ul><li>只有被 proposer 提出的提案(proposal)才能被选定</li><li>一次 Paxos 执行，只能有一个值(v)被选定</li><li>learner 只能获得被批准的提案(value)</li></ul><h2 id="推导"><a href="#推导" class="headerlink" title="推导"></a>推导</h2><p>Lamport 大神通过不断加强上述的三个约束(主要是第二个约束)，获得了 Paxos 算法。</p><h3 id="1-P1"><a href="#1-P1" class="headerlink" title="1. P1"></a>1. P1</h3><p>当只有一个 acceptor 存在时，acceptor 会选择它收到的第一个 proposal 作为 value(选定的提案)，提案流程结束。</p><p>然而，一个 acceptor 会导致单点问题，即这个 acceptor 挂掉后，整个分布式集群就无法工作(zk 通过 ZAB 协议解决了单点问题，不过在选举的过程中，仍然是多 acceptor)。</p><p>多 acceptor 时， proposer 向 acceptor 集合 (acceptors) 发送 proposal，当有足够多的 acceptor 接受时，这个 proposal 就被选定，成为决议(value)。</p><p>这里的足够多，我们认为是超过半数的 acceptor ，亦即前文的 quorun。</p><p>因为两组 quorum，必然至少包含同一个 acceptor， 如果一个 acceptor 最多只能通过一个提案，那么就能保证最终只有一个提案被选定。</p><p>我们希望在即使只有一个提案被提出的情况下，仍然能产生 value，由此我们得到 P1:</p><blockquote><p><strong>P1: 一个 acceptor 必须接受它第一次收到的提案</strong></p></blockquote><p>注意，这里的 P1 是不完备的。当 acceptor 个数为偶数，又恰好一半 acceptor 接受 A 提议，另一半接受 B 提议时，此时无法产生决议。</p><p>提案被选定需要半数以上 acceptor 通过，意味着，一个 acceptor 必须能通过不止一个提案。当一个具有 v 值的提案被 quorum 通过，我们就认为提案被选定。</p><h3 id="2-P2"><a href="#2-P2" class="headerlink" title="2. P2"></a>2. P2</h3><p>我们基于上文以及基准约束 2：</p><blockquote><p>一次 Paxos 执行，只能有一个值(v)被选定</p></blockquote><p>可以看到， Paxos 并不要求只批准一个 proposal，也就是说可能会批准多个提案。只要提案的值，即 proposal.v 一致，就不违背基准约束 2 ，于是我们得出</p><blockquote><p><strong>P2: 一旦一个具有 v 值的提案 proposal(n,v) 被批准，则之后批准的提案必须具有 v 值</strong></p></blockquote><p>这里的之后，一般都是通过一个全局序号(zk 中指 zxid)，来进行判断</p><h3 id="3-P2a"><a href="#3-P2a" class="headerlink" title="3. P2a"></a>3. P2a</h3><p>批准一个 value，意味着多个 acceptor 接受了这个 value，因此可以对 P2 进行加强：</p><blockquote><p>P2a：一旦一个 proposal(n,v) 被批准，则之后任何 acceptor 再次接受的提案，必须也具有 v 值</p></blockquote><p>满足 P2a ,即满足 P2</p><p>但是由于通信是异步的，当已经产生 value 后，一个 proposer 和 acceptor 刚苏醒，而这个 proposer 提出了一个新的 proposal(n1,v1) 提案，根据 P1 ，这个 acceptor 应该接受，但根据 P2a，又不应该接受！怎么办？</p><h3 id="4-P2b"><a href="#4-P2b" class="headerlink" title="4. P2b"></a>4. P2b</h3><p>我们想到在 proposer 端进行限制：</p><blockquote><p>P2b：一旦一个 proposal(n,v) 被批准，则之后任何 proposer 提出的提案，必须具有 v 值</p></blockquote><p>一个提案被 acceptor 接受前，需要由 proposer 提出，因此， 满足 P2b ==&gt; P2a ==&gt; P2</p><p>如何保证 P2b 呢？</p><p>我们假设 proposal(m,v) 提案被选定，根据 P2b， 则有 proposal(n,v’)，当 n &gt; m 时， v’ = v .</p><p>那么，如何来保证 v’ = v 呢？</p><h3 id="5-P2c"><a href="#5-P2c" class="headerlink" title="5. P2c"></a>5. P2c</h3><blockquote><p>P2c：若 proposal(n,v) 被提出，则存在一个 quorum 满足以下中的任一条件：</p><p>​    a)  quorum 中所有 acceptor 都未接受编号小于 n 的提案</p><p>​    b)  quorum 中所有 acceptor 已经接受所有编号小于 n 的提案中，最大的那个提案 v 值</p></blockquote><p>证明过程如下：</p><blockquote><p>假设具有value v的提案m获得批准，当n=m+1时，采用反证法，假如提案n不具有value v，而是具有value w，根据P2c，则存在一个多数派S1，要么他们中没有人接受过编号小于n的任何提案，要么他们已经接受的所有编号小于n的提案中编号最大的那个提案是value w。由于S1和通过提案m时的多数派C之间至少有一个公共的acceptor，所以以上两个条件都不成立，导出矛盾从而推翻假设，证明了提案n必须具有value v；</p><p>若（m+1）..（N-1）所有提案都具有value v，采用反证法，假如新提案N不具有value v，而是具有value w’,根据P2c，则存在一个多数派S2，要么他们没有接受过m..（N-1）中的任何提案，要么他们已经接受的所有编号小于N的提案中编号最大的那个提案是value w’。由于S2和通过m的多数派C之间至少有一个公共的acceptor，所以至少有一个acceptor曾经接受了m，从而也可以推出S2中已接受的所有编号小于n的提案中编号最大的那个提案的编号范围在m..（N-1）之间，而根据初始假设，m..（N-1）之间的所有提案都具有value v，所以S2中已接受的所有编号小于n的提案中编号最大的那个提案肯定具有value v，导出矛盾从而推翻新提案n不具有value v的假设。根据数学归纳法，我们证明了若满足P2c，则P2b一定满足。</p><p>—- <a href="https://zh.wikipedia.org/wiki/Paxos%E7%AE%97%E6%B3%95" target="_blank" rel="noopener">WIKI</a></p></blockquote><p>为了维护 P2c 的不变性，当一个 proposer 提出 proposal(n,v) 时，必须要知道某一个将要或者已经被 quorum 通过的编号小于 n 的最大编号的提案值。</p><p>我们需要限定「将要通过」的情况，毕竟我们无法预测未来。这表示，proposer 会请求 acceptor 不再接受任何编号小于 n 的提案。</p><h3 id="6-算法"><a href="#6-算法" class="headerlink" title="6. 算法"></a>6. 算法</h3><p>上面的分析，可以推出如下算法：</p><h4 id="1-Proposer"><a href="#1-Proposer" class="headerlink" title="1. Proposer"></a>1. Proposer</h4><h5 id="1-1-prepare"><a href="#1-1-prepare" class="headerlink" title="1.1 prepare"></a>1.1 prepare</h5><ul><li>proposer 提交 proposal(n,v) 给 acceptors</li><li>proposer 要求 acceptor 做出如下承诺：<ul><li>保证不再通过任何小于编号 n 的提案</li><li>如果存在已通过的编号小于 n 的提案，将通过的小于 n 的最大编号提案返回</li></ul></li></ul><h5 id="1-2-commit-propose"><a href="#1-2-commit-propose" class="headerlink" title="1.2 commit/propose"></a>1.2 commit/propose</h5><ul><li>收到超过半数的 ack 回复，则产生 proposal(n, v)，这里的 v 是所有响应中编号最大的提案的 v 值，若响应中不包含，则由 proposer 自己选择</li></ul><h4 id="2-Acceptor"><a href="#2-Acceptor" class="headerlink" title="2. Acceptor"></a>2. Acceptor</h4><blockquote><p>P1a： acceptor 可以接受一个编号为 n 的提案，只要它还未响应任何编号大于 n 的 prepare 请求</p></blockquote><p>可以看出： P1a 蕴涵 P1</p><h5 id="2-1-prepare"><a href="#2-1-prepare" class="headerlink" title="2.1 prepare"></a>2.1 prepare</h5><ul><li>收到 propser 的 prepare(n.v) 请求，如果编号 n &gt; 所有响应中最大的提案编号，返回已经通过的最大编号的提案(没有可以返回 nil)</li></ul><h5 id="2-2-commit-accept"><a href="#2-2-commit-accept" class="headerlink" title="2.2 commit/accept"></a>2.2 commit/accept</h5><ul><li>收到 proposer 的 accept 请求后，如果没有对编号大于 n 的 prepare 请求做出过响应，就接受这个提案</li></ul><h4 id="3-整体描述"><a href="#3-整体描述" class="headerlink" title="3. 整体描述"></a>3. 整体描述</h4><h5 id="3-1-prepare-阶段："><a href="#3-1-prepare-阶段：" class="headerlink" title="3.1 prepare 阶段："></a>3.1 prepare 阶段：</h5><ul><li>proposer  发送 prepare(n,v) 给 acceptors</li><li>acceptor 收到 prepare(n,v) 后，如果 n 大于它已经响应的所有 prepare 请求编号， 则保证不再 <font color="#ff0000">accept</font> 任何编号小于 n 的提案，同时将已经通过的最大编号的提案(如果存在)回复。(这里已经通过，指的是该 acceptor 接受的提案，而不是 prepare 响应的提案)</li></ul><h5 id="3-2-propose-阶段："><a href="#3-2-propose-阶段：" class="headerlink" title="3.2 propose 阶段："></a>3.2 propose 阶段：</h5><ul><li>proposer 在收到大多数 acceptors 的回复后，根据回复，获取回复中编号最大的 value(如果所有回复中，都没有，则 value 可自行确定)，向 acceptors 发送 accept(n,v) 请求</li><li>在不违背 acceptor 对其他 proposer 的承诺下，acceptor 接受这个提案，否则拒绝。换句话说，即 如果 acceptor 收到一个针对编号 n 的提案的 accept 请求，<strong>只要它还未对编号大于 n 的 prepare 请求作出响应，它就可以通过这个提案</strong>。</li></ul><h3 id="7-流程图"><a href="#7-流程图" class="headerlink" title="7. 流程图"></a>7. 流程图</h3><p>我们以两个 proposer 和 3 个 acceptor 为例。</p><p>prepare 阶段，主要有两个方法</p><ul><li>prepare(n, expected_v) ： 由 proposer 发起一个编号为 n，值为 expected_v 的请求</li><li>promise(ack, accepted_n, accepted_v)：由 acceptor 返回，ack 为应答，accepted_n 为 acceptor 已经通过提案的最大编号，accepted_v 为对应的值，没有则为 nil</li></ul><p>accept/propose 阶段，也是两个方法</p><ul><li>propose(n，expected_v)：在该 proposer 收到超过半数 ack 后，发起 propose(n,expected_v) 请求，expected_v 为收到的应答中，最大编号的值，如果没有，就是自己的值</li><li>accept(ack, error)： 在不违背对其他 acceptor 的承诺下，acceptor 接受这个提案，返回(ack, nil)， 否则返回 (ack, error)</li></ul><p><em>注</em> ： 这里<em>不违背对其他 acceptor 的承诺</em>  ，指的是</p><ul><li>不响应编号比 n 小的提案</li><li>不接受编号比 n 小的提案</li></ul><p>WIKI 中说</p><blockquote><p>acceptor收到prepare消息后，如果提案的编号大于它已经回复的所有prepare消息(回复消息表示接受accept)，则acceptor将自己上次接受的提案回复给proposer，并承诺不再回复小于n的提案</p></blockquote><p>这里的<strong>承诺不再回复小于 n 的提案</strong> ，即指上面的两个不。</p><p>在 acceptor 收到 accept 请求前，如果收到了 prepare(n+1, v’)，那个这个 accept 请求则不会被应答，或者返回一个 error</p><h4 id="prepare"><a href="#prepare" class="headerlink" title="prepare"></a>prepare</h4><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://img.iyuhp.top/blog/20200402124723.png-growing" alt="prepare phrase"></p><p>P1 和 P2 分别向 A1/A2, A2/A3 发送 prepare 请求，A1/A3 都是正常应答，同时将各自的应答记录修改。</p><p>A2 先收到 P1 prepare 请求，responsed_n 置为 1， 同时给与 P1 ack， 后收到 P2 prepare(2, 2)，根据规则，P2 的提案编号 2 大于 P1 的编号 1，所以，A2 将 responsed_n 置为 2， 同时回复 ack。这里 A2 在此之前，并没有批准，即 accept 任何提案，所以回复的 promise 应该为 promise(ack, nil, nil)</p><p>那么此时 P1 和 P2 都得到了半数以上的 ack ，都可以进行 accept 请求。</p><h4 id="propose-accept"><a href="#propose-accept" class="headerlink" title="propose/accept"></a>propose/accept</h4><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://img.iyuhp.top/blog/20200402134022.png-growing" alt="accept phrase"></p><p>在第二阶段</p><p>P1， 向 A1, A2, A3 发起 propose(1, 1) 请求， 其中：</p><ul><li>A1： 在 P2 发送请求之前，收到了 P1 的 propose 请求，在此之前只收到过 P1 的 prepare 请求，未对编号大于 1 的 prepare 请求做出过回应，遵守承诺，接受了 P1 的请求，回复 ack， accept(ack, nil, nil)</li><li>A2/A3：已经收到过 P2 的 prepare 请求，且 P2 编号 2， 大于 1，不回复 P1 或回复 error</li></ul><p>所以 P1 得到 A1 的 ack ，未超过半数</p><p>P2， 向 A1， A3 发起 propose(2, 2) 请求，其中：</p><ul><li>A1： 未作出过大于 2 的 prepare 响应，接受 P2 的请求，修改 responsed_n，accepted_n/v 同时返回 accept(ack)</li><li>A3：同样未违背承诺，修改 responsed_n, accepted_n/v ， 返回 accept(ack)</li></ul><p>P2 收到半数以上的 ack ，提案被选中。</p><p>之后 A1 再次去发起提案的时候，此时 n 会递增到 3，在 prepare(3,1) 阶段，会收到 A1，A3 的 ack，形如 propose(ack, 2, 2)， A1 收到半数请求后，从中挑出编号不大于 3 的最大编号，同时修改自己的值， 从 1 变为 2，再次发送 prepare(3,2)，会得到超过半数的 ack ， 提案被选中，结束。</p><p>本轮 paxos 中，最终选择的值为 2</p><h3 id="8-Paxos-活锁-LiveLock"><a href="#8-Paxos-活锁-LiveLock" class="headerlink" title="8. Paxos  活锁(LiveLock)"></a>8. Paxos  活锁(LiveLock)</h3><p>我们以 P1, P2 + A 为例</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://img.iyuhp.top/blog/20200402140130.png-growing" alt="prepare phrase LiveLock"></p><p>如图示，每次 P1 或 P2 propose 时， 总是会发现更高的 prepare 编号，从而不断进行 prepare 。</p><p>一般这种情况很少见，可以通过 <em>随即睡眠-重试</em> 的方法避免</p><h2 id="Multi-Paxos"><a href="#Multi-Paxos" class="headerlink" title="Multi-Paxos"></a>Multi-Paxos</h2><h2 id="Fast-Paxos"><a href="#Fast-Paxos" class="headerlink" title="Fast-Paxos"></a>Fast-Paxos</h2><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul><li><a href="https://zh.wikipedia.org/wiki/Paxos%E7%AE%97%E6%B3%95" target="_blank" rel="noopener">WIKI Paxos 算法</a></li><li><a href="https://github.com/oldratlee/translations/tree/master/paxos-made-simple" target="_blank" rel="noopener">Paxos Made Simple 翻译稿</a></li></ul><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> zookeeper </category>
          
      </categories>
      
      
        <tags>
            
            <tag> middleware </tag>
            
            <tag> algorithm </tag>
            
            <tag> zk </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Build Your Own Blog</title>
      <link href="/tools/blog/"/>
      <url>/tools/blog/</url>
      
        <content type="html"><![CDATA[<h1 id="hexo-搭建个人博客"><a href="#hexo-搭建个人博客" class="headerlink" title="hexo 搭建个人博客"></a>hexo 搭建个人博客</h1><p>使用 theme： <a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank" rel="noopener">https://github.com/blinkfox/hexo-theme-matery</a> </p><p>关于该主题的使用：<a href="https://github.com/blinkfox/hexo-theme-matery/blob/develop/README_CN.md" target="_blank" rel="noopener">https://github.com/blinkfox/hexo-theme-matery/blob/develop/README_CN.md</a></p><p>hexo： <a href="https://github.com/hexojs/hexo" target="_blank" rel="noopener">https://github.com/hexojs/hexo</a></p><h2 id="BLOG-地址"><a href="#BLOG-地址" class="headerlink" title="BLOG 地址"></a>BLOG 地址</h2><p><a href="https://iyuhp.top">iyuhp’s blog</a> </p><h2 id="基本介绍"><a href="#基本介绍" class="headerlink" title="基本介绍"></a>基本介绍</h2><p>本 blog 使用 <a href="https://github.com/hexojs/hexo" target="_blank" rel="noopener">HEXO</a> 搭建， <a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank" rel="noopener">MATERY</a> 作为主题， nginx 作静态代理，搭配 HTTPS 使用。</p><h2 id="搭建步骤"><a href="#搭建步骤" class="headerlink" title="搭建步骤"></a>搭建步骤</h2><h3 id="1-安装-hexo-cli"><a href="#1-安装-hexo-cli" class="headerlink" title="1. 安装 hexo-cli"></a>1. 安装 hexo-cli</h3><p>安装之前，请确认本机已经有 node 环境，可选择安装 cnpm。</p><pre class=" language-shell"><code class="language-shell">cnpm install -g hexo-cli</code></pre><h3 id="2-初始化一个-project"><a href="#2-初始化一个-project" class="headerlink" title="2. 初始化一个 project"></a>2. 初始化一个 project</h3><pre class=" language-shell"><code class="language-shell">hexo init blogcd blogcnpm i</code></pre><p>此时，通过 <code>tree . -L 1</code> 命令查看</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://img.iyuhp.top/blog/20200401073032.png-growing" alt="image-20200401073027300"></p><ul><li><p>_config.yml: 网站的配置信息， 绝大部分的配置，都在这里修改，这里的配置是你自己的配置</p></li><li><p>scaffolds： 模板文件夹，新建文章时， 根据其中的模板进行填充相关内容，可以在 _config.yml 中配置选择使用哪种模板</p></li><li><p>source：用户存放资源的地方。 除  _posts 文件夹之外，开头命名为 _ (下划线)的文件、文件夹和隐藏的文件将会被忽略。Markdown 和 HTML 文件会被解析并放到 public 文件夹，而其他文件会被拷贝过去</p></li><li><p>themes：主题文件夹， hexo 根据主题来生成静态页面，主题目中也会有一个 _config.yml 配置文件，是关于主题的配置</p></li></ul><h3 id="3-使用主题"><a href="#3-使用主题" class="headerlink" title="3. 使用主题"></a>3. 使用主题</h3><p>关于 matery 主题的使用，可以参考 <a href="https://github.com/blinkfox/hexo-theme-matery/blob/develop/README_CN.md" target="_blank" rel="noopener">这里</a> 。</p><p>我们把下载下来的稳定版本 copy 到 themes 目录下，然后在 _config.yml 中指定主题为 <code>hexo-theme-matery</code> , 同时参考 matery 文档，完成其他配置后，执行 <code>hexo s</code> 本地启动后，查看效果。</p><p>使用主题的方式有：</p><ol><li><p>直接下载后添加</p></li><li><p>或者 git clone 到 theme 目录下</p></li><li><p>或者 通过 git submodule</p><pre class=" language-shell"><code class="language-shell">git submodule add https://github.com/blinkfox/hexo-theme-matery.git themes/hexo-theme-matery</code></pre></li></ol><h3 id="4-新建文章"><a href="#4-新建文章" class="headerlink" title="4. 新建文章"></a>4. 新建文章</h3><p>在 <a href="https://hexo.io/zh-cn/docs/configuration" target="_blank" rel="noopener">这里</a> 可以查看到关于 hexo 的各种命令。</p><p>使用 *<em><code>hexo new --path folder/article "Oh Beautiful"</code> *</em>，会在当前 source/_post 目录下(这里根据你配置里的 default_layout，会在对应的目录下新建)新建一个 folder 目录，folder 目录中新建 article.md 文件， title 为 Oh Beautiful 。<br>这个命相比较于直接 new ， 好处是能把文章按照目录进行分类。</p><p>这里贴一份我的 scaffold 里 post.md 的 layout：</p><pre class=" language-markdown"><code class="language-markdown"><span class="token hr punctuation">---</span>title: {{ title }}date: {{ date }}author: peifengimg: {{ zhankeng }}top: truecover: truecoverImg: {{ zhankeng }}password: passwordpasswordpasswordtoc: truemathjax: falsesummary: {{ zhankeng }}categories: Markdowntags:  <span class="token list punctuation">-</span> Typora  - <span class="token title important">Markdown<span class="token punctuation">---</span></span></code></pre><p>官网关于 new 命令的介绍</p><p>更多配置说明请参考 <a href="https://hexo.io/zh-cn/docs/configuration" target="_blank" rel="noopener">这里</a></p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://img.iyuhp.top/blog/20200401070947.png-growing" alt="image-20200401070945664"></p><h3 id="5-使用评论插件"><a href="#5-使用评论插件" class="headerlink" title="5. 使用评论插件"></a>5. 使用评论插件</h3><p>hexo 的评论插件有很多种，比如 gitalk，gitment，disqus(国内基本可以不考虑)，valine 等，我看了各种效果， valine 和 gitalk 比较满意。</p><p>valine 需要先到 <a href="https://www.leancloud.cn/" target="_blank" rel="noopener">LeanCloud</a> 上注册账号，它会提供给开发者一个 <strong>1G</strong> 的免费存储空间( <a href="https://www.leancloud.cn/pricing/" target="_blank" rel="noopener">计价方案</a>)，超出部分 0.10 元 / GB / 天。 个人 blog，感觉肯定是够用的(这里不得不感叹，果然是能薅羊毛，就薅羊毛啊，啊哈哈哈)，因为其实不会有多少人来评论的！！！</p><p>不过我对于 valine 的权限控制有点不满意。因为我本身有后台服务支撑，后续打算对 valine 做点改动，所有评论由我自己递交给 leancloud，这样就不用暴露 leancloud 的 ak 和 sk 了。当然，这是静态 blog 的通病，木的办法。</p><p>而 gitalk，则是基于 github issue 做的实现，所有的评论，其实都是 github 上一个 repo 的 issue。这样的话，我其实不用关心这个 repo 的最终结局会怎样，大不了我删了重建一个新 repo 呗。</p><p>当然，gitalk 有两个问题</p><ol><li>网络问题，经常性出现 Network Error 之类的问题</li><li>权限问题，用户留言时，gitalk 会要求用户给与十分大的权限，如果这个 blog 博主拿到权限后，做了一些乱七八糟的事情，可就不太好了。。。我就碰到自动 fork 博主项目的</li></ol><p>关于 gitalk 的使用：</p><p><a href="https://github.com/gitalk/gitalk/blob/master/readme-cn.md" target="_blank" rel="noopener">gitalk 文档</a></p><ol><li>在 <a href="https://github.com/settings/applications/new" target="_blank" rel="noopener">New Oauth</a> 上新建一个授权应用</li></ol><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://img.iyuhp.top/blog/20200401073717.png-growing" alt="image-20200401073715809"></p><p>callback URL， 这里说下，根据 oauth2 协议，这个 callback URL 就是完成授权后的回调地址，这里可以填写自己网站的首页。</p><ol start="2"><li>完成后会拿到 client id 和 client secret，填入到 theme 下的 _config.yml 即可。</li></ol><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://img.iyuhp.top/blog/20200401073826.png-growing" alt="image-20200401073822373"></p><ul><li>repo： 即你的评论提交的地方，一个 github repo</li><li>owner: 你 repo 所属的组织或者个人</li><li>admin: 对这个 repo 有写权限的人</li></ul><p>然后你就能愉快的使用评论功能了</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://img.iyuhp.top/blog/20200401073953.png-growing" alt="image-20200401073951830"></p><h3 id="6-其他优化"><a href="#6-其他优化" class="headerlink" title="6. 其他优化"></a>6. 其他优化</h3><h4 id="6-1-图片懒加载"><a href="#6-1-图片懒加载" class="headerlink" title="6.1 图片懒加载"></a>6.1 图片懒加载</h4><h4 id="6-2-代码压缩"><a href="#6-2-代码压缩" class="headerlink" title="6.2 代码压缩"></a>6.2 代码压缩</h4><h4 id="6-3-SEO-优化"><a href="#6-3-SEO-优化" class="headerlink" title="6.3 SEO 优化"></a>6.3 SEO 优化</h4><p>参考 <a href="https://blog.sky03.cn/posts/42790.html" target="_blank" rel="noopener">hexo 优化</a></p><h4 id="6-4-CDN-加速"><a href="#6-4-CDN-加速" class="headerlink" title="6.4 CDN 加速"></a>6.4 CDN 加速</h4><p>关于 CDN 加速，也是通过 github + <a href="https://www.jsdelivr.com/" target="_blank" rel="noopener">jsDelivr</a> 完成。具体操作就是，在发布代码的时候，如果本身就托管在 github 上，那最方便，直接在 theme 主题下的 _config.yml 中配置 <code>jsDelivr.url</code> 即可，形如：</p><pre><code># 如你的 repo 地址： https://github.com/A/B# 则这里的地址就这样填写https://cdn.jsdelivr.net/gh/A/B</code></pre><p>再次访问的时候， 就会去这里访问静态资源了。<br>我个人只把一部分如 css/js/libs 放到了 github 上，其他的，放在自己的 ecs 上。<br>关于 SEO 优化， 上面的文章也写的很详细了， 我个人只配置了 google 的， baidu 要做各种认证，就懒得配了，啊哈哈哈。</p><h3 id="7-百度统计"><a href="#7-百度统计" class="headerlink" title="7. 百度统计"></a>7. 百度统计</h3><p><a href="https://tongji.baidu.com/web/10000169496/welcome/login" target="_blank" rel="noopener">百度统计</a> 可以用来分析网站各个维度的信息，比如访问人数， pv， uv 等。<br>用起来也很简单， 先在 <a href="https://tongji.baidu.com/web/10000169496/welcome/login" target="_blank" rel="noopener">这里</a> 注册一个账号，创建一个应用，获取 id， 然后到 theme 下的 baiduAnalytics 那开启并配置 id ，即可看到一些统计信息了。</p><h3 id="8-end"><a href="#8-end" class="headerlink" title="8. end"></a>8. end</h3><p>至此，在本地就能很方便的访问了</p><h2 id="域名"><a href="#域名" class="headerlink" title="域名"></a>域名</h2><p>在 <a href="https://wanwang.aliyun.com/domain/" target="_blank" rel="noopener">域名注册</a> 这里可以挑选一个合适的域名， 我当时买的时候，<em>.top</em>  后缀三年，好像才几十块钱。注册完成后，看你自己选择，要不要备案。如果选择备案，需要打印一张表格，填完后拍照上传，之后到阿里云备案，阿里云会免费邮寄一张蓝色的幕布(就是一张蓝色的纸…)，然后你需要拍照上传。整个过程大约一个礼拜左右能搞定。不需要花钱。</p><h2 id="服务器"><a href="#服务器" class="headerlink" title="服务器"></a>服务器</h2><p>但是阿里云搞活动，我选购了一台， 很便宜了。现在不知道是什么情况</p><h2 id="SSL-证书"><a href="#SSL-证书" class="headerlink" title="SSL 证书"></a>SSL 证书</h2><p>免费的 SSL 证书，提供商也很多，我这里选择的是 <a href="https://freessl.cn/" target="_blank" rel="noopener">FreeSSL</a> ， 选择 Let’s Encrypt V2 ， 可以搞泛域名证书，这个还是很开心的。</p><p>如果你不需要泛域名， 只是单域名，那完全可以直接到阿里云/腾讯云等各个平台免费申请，都是一年的免费申请。还很方便。</p><p>在 freeSSL 上申请证书的时候，他会给你几个 TXT 类型的 DNS 解析，这个需要配置到你的 DNS 服务商那里。</p><p>阿里云的话， 在 <a href="https://dc.console.aliyun.com/next/index?spm=a2c1d.8251892.favorites.ddomain.784c5b76NZRlLv#/domain/list/all-domain" target="_blank" rel="noopener">这里</a> 应该能找到配置</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://img.iyuhp.top/blog/20200401074420.png-growing" alt="image-20200401074419037"></p><p>新添加后，基本都是立即生效的。(虽然说的是 10 分钟生效，还是相当谦虚的)</p><p>不过申请的 SSL 有效期，<font color="#ff0000"><strong>只有三个月</strong></font> ！！！注意需要定期更换</p><h2 id="Nginx-配置-1-14-1"><a href="#Nginx-配置-1-14-1" class="headerlink" title="Nginx 配置 (1.14.1)"></a>Nginx 配置 (1.14.1)</h2><p>在这一部分， 需要一个(备案的)域名，一台服务器(ecs)，以及 ssl 证书</p><p>Linux 下安装 nginx，这里不再赘述，centos 8 可以直接通过 <code>sudo dnf install nginx -y</code> 安装</p><p>这里多说一句， dnf 相比较于 yum，要更好用，按照历史规矩， yum 在将来，应该会被 dnf 取代。</p><p>再多说一句， centos 8 ，终于不再依赖 python2.7 了，vim 的基础版本也是 8.0，对于想要安装 YCM 的童鞋来说，也算是一个不错的好消息。</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://img.iyuhp.top/blog/20200401074825.png-growing" alt="image-20200401074823558"></p><p>我的 nginx 目录长这样。</p><p>在 nginx.conf 中， include conf.d 目录下所有的 *.conf 的配置文件，这算很常见的配置方案，对于多应用来说，可以各自维护各自的 conf 文件。</p><p>我们在 <a href="https://ssl-config.mozilla.org/#server=nginx&amp;version=1.14.1&amp;config=intermediate&amp;openssl=1.1.1d&amp;guideline=5.4" target="_blank" rel="noopener">这里</a> 能找到一份不错的 nginx 配置，由 mozilla 推荐的配置</p><p>这是 nginx.conf 的完整配置以及 https 优化。</p><pre class=" language-nginx"><code class="language-nginx"><span class="token comment" spellcheck="true"># ...</span><span class="token comment" spellcheck="true"># 加载 nginx 模块</span><span class="token keyword">include</span> <span class="token operator">/</span>usr<span class="token operator">/</span>share<span class="token operator">/</span>nginx<span class="token operator">/</span>modules<span class="token operator">/</span><span class="token operator">*</span><span class="token punctuation">.</span>conf<span class="token punctuation">;</span><span class="token keyword">http</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true"># ...</span>    <span class="token keyword">sendfile</span>            on<span class="token punctuation">;</span>    <span class="token keyword">tcp_nopush</span>          on<span class="token punctuation">;</span>    <span class="token keyword">tcp_nodelay</span>         on<span class="token punctuation">;</span>    <span class="token keyword">keepalive_timeout</span>   <span class="token number">65</span><span class="token punctuation">;</span>    <span class="token keyword">types_hash_max_size</span> <span class="token number">2048</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true"># 全局 ssl 证书配置</span>    <span class="token keyword">ssl_certificate</span>      <span class="token operator">/</span>etc<span class="token operator">/</span>pki<span class="token operator">/</span>nginx<span class="token operator">/</span>server_ssl<span class="token punctuation">.</span>crt<span class="token punctuation">;</span>    <span class="token keyword">ssl_certificate_key</span>  <span class="token operator">/</span>etc<span class="token operator">/</span>pki<span class="token operator">/</span>nginx<span class="token operator">/</span>private<span class="token operator">/</span>server_ssl<span class="token punctuation">.</span>key<span class="token punctuation">;</span>    <span class="token keyword">ssl_certificate</span>     <span class="token operator">/</span>etc<span class="token operator">/</span>pki<span class="token operator">/</span>nginx<span class="token operator">/</span>ssl_ecc<span class="token punctuation">.</span>crt<span class="token punctuation">;</span>    <span class="token keyword">ssl_certificate_key</span> <span class="token operator">/</span>etc<span class="token operator">/</span>pki<span class="token operator">/</span>nginx<span class="token operator">/</span>private<span class="token operator">/</span>ssl_ecc<span class="token punctuation">.</span>key<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true"># session 配置</span>    <span class="token keyword">ssl_session_cache</span>    shared<span class="token punctuation">:</span><span class="token keyword">SSL</span><span class="token punctuation">:</span>10m<span class="token punctuation">;</span>    <span class="token keyword">ssl_session_timeout</span>  1d<span class="token punctuation">;</span>    ssl_session_tickets  off<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true"># 协议配置 ssl_ciphers 仅作示例，具体配置下文有说明</span>    <span class="token keyword">ssl_protocols</span>       TLSv1<span class="token number">.2</span> TLSv1<span class="token number">.3</span><span class="token punctuation">;</span>    <span class="token keyword">ssl_prefer_server_ciphers</span>   off<span class="token punctuation">;</span>    <span class="token keyword">ssl_ciphers</span>         CDHE<span class="token operator">-</span>ECDSA<span class="token operator">-</span>AES128<span class="token operator">-</span>GCM<span class="token operator">-</span>SHA256<span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># TODO 开启 oscp</span>    <span class="token comment" spellcheck="true"># ssl_stapling      on;</span>    <span class="token comment" spellcheck="true"># ssl_stapling_verify       on;</span>    <span class="token comment" spellcheck="true"># ssl_trusted_certificate   ospc_file_path</span>    <span class="token comment" spellcheck="true"># common header 证书有效期问题，这里设置 7776000 </span>    <span class="token keyword">add_header</span> Strict<span class="token operator">-</span>Transport<span class="token operator">-</span>Security <span class="token string">"max-age=7776000;"</span> always<span class="token punctuation">;</span>    <span class="token keyword">add_header</span> X<span class="token operator">-</span>Frame<span class="token operator">-</span>Options <span class="token string">"SAMEORIGIN"</span> always<span class="token punctuation">;</span>    <span class="token keyword">add_header</span> X<span class="token operator">-</span>Xss<span class="token operator">-</span>Protection <span class="token string">"1; mode=block"</span> always<span class="token punctuation">;</span>    <span class="token keyword">add_header</span> X<span class="token operator">-</span>Content<span class="token operator">-</span>Type<span class="token operator">-</span>Options <span class="token string">"nosniff"</span> always<span class="token punctuation">;</span>    brotli on<span class="token punctuation">;</span>    brotli_static on<span class="token punctuation">;</span>    brotli_min_length   <span class="token number">100</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># 大于或等于 50 字节时才会进行压缩</span>    brotli_comp_level   <span class="token number">6</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># 压缩等级 默认 6 越高 cpu 用的越多</span>    brotli_buffers      <span class="token number">16</span> 8k<span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># 请求缓冲区的数量和大小</span>    brotli_types text<span class="token operator">/</span>plain text<span class="token operator">/</span>css text<span class="token operator">/</span>javascript application<span class="token operator">/</span>javascript text<span class="token operator">/</span>xml application<span class="token operator">/</span>xml image<span class="token operator">/</span>svg<span class="token operator">+</span>xml application<span class="token operator">/</span>json<span class="token punctuation">;</span>    <span class="token keyword">include</span> <span class="token operator">/</span>etc<span class="token operator">/</span>nginx<span class="token operator">/</span>conf<span class="token punctuation">.</span>d<span class="token operator">/</span><span class="token operator">*</span><span class="token punctuation">.</span>conf<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h3 id="1-全局-ssl-证书配置"><a href="#1-全局-ssl-证书配置" class="headerlink" title="1. 全局 ssl 证书配置"></a>1. 全局 ssl 证书配置</h3><p>这里采用的是双证书模式，RSA 和 ECC 两种加密方式的证书。如果各自的 conf 有新证书，直接在各自的 conf 中配置，会覆盖掉全局的配置</p><h3 id="2-session-配置"><a href="#2-session-配置" class="headerlink" title="2. session 配置"></a>2. session 配置</h3><p>一般开启服务端 session 缓存，1M 大约能缓存 4000 个 session，这里配置了 10M</p><h3 id="3-协议优化"><a href="#3-协议优化" class="headerlink" title="3. 协议优化"></a>3. 协议优化</h3><p>TLSv1.1， TLSv1.2，TLSv1.3， TLSv1.3 相较于前者， 做到了更安全和更快， 如果你不需要向前兼容，直接选择 TLSv1.3 就好了。我本来也如此，后来对接 gitee 的 push hooks 的时候，发现握手一直挂，无奈，又配上了 TLSv1.2</p><p>关于 <code>ssl_prefer_server_ciphers off</code>  这个选项的更多解释：<a href="https://github.com/mozilla/server-side-tls/issues/260" target="_blank" rel="noopener">GITHUB ISSUE</a></p><h3 id="4-add-header"><a href="#4-add-header" class="headerlink" title="4. add_header"></a>4. add_header</h3><p>是一些列的安全配置和 hsts 配置</p><h3 id="5-brotli-压缩"><a href="#5-brotli-压缩" class="headerlink" title="5. brotli 压缩"></a>5. brotli 压缩</h3><p>一种压缩算法，比常用 gzip 要更给力。目前几乎所有主流浏览器都支持了 br ，但不免有漏网之鱼，所以可以选择同时支持 br 和 gzip 。</p><p>在使用 br 之前，需要先给 nginx 加上 brotli 模块。在 centos 8 下，操作如下：</p><h4 id="5-1-下载-nginx"><a href="#5-1-下载-nginx" class="headerlink" title="5.1 下载 nginx"></a>5.1 下载 nginx</h4><p>具体哪个版本，视你安装的 nginx 版本而定，可通过 <code>nginx -V</code> 查看， 我这里使用的是 <strong>nginx/1.14.1</strong> </p><pre class=" language-shell"><code class="language-shell"># 这之前， 你可能需要安装一些基础工具包sudo dnf install -y curl wget unzip socat bash-completion epel-release && sudo dnf groupinstall "Development Tools"sudo dnf install -y pcre pcre-devel zlib zlib-devel openssl openssl-develwget https://nginx.org/download/nginx-1.14.1.tar.gz && tar zxvf nginx-1.14.1.tar.gz</code></pre><h4 id="5-2-下载-brotli"><a href="#5-2-下载-brotli" class="headerlink" title="5.2 下载 brotli"></a>5.2 下载 brotli</h4><pre class=" language-shell"><code class="language-shell">git clone https://github.com/google/ngx_brotli.gitcd ngx_brotli && git submodule update --init</code></pre><h4 id="5-3-编译"><a href="#5-3-编译" class="headerlink" title="5.3 编译"></a>5.3 编译</h4><p>这里要十分的注意，我们需要编译的 <code>.so</code> 文件，最终是我们已经安装的 nginx 去执行，所以我们在 make 的时候，所有的环境配置需要和已安装的 nginx 一致。</p><p>我最开始的时候没有注意到这一点，踩了坑，最后 restart nginx 的时候，一致报 <strong>is not binary compatible</strong> 之类的错误</p><pre class=" language-shell"><code class="language-shell"># 1. 获取当前运行 nginx 的环境配置sudo nginx -V# 进入下载的 nginx 源码目录操作# 上一步会输出 configure arguments，我们设为 A， 把他们全部加入其中# --add-dynamic-module=../ngx_brotli 这里的路径根据你下载 brotli 的位置而定./configure A --add-dynamic-module=../ngx_brotli</code></pre><p>这一步执行的时候，可能还会报错，一般都是缺少依赖。如：</p><pre class=" language-shell"><code class="language-shell"># This is perl 5, version 26, subversion 3 (v5.26.3) built for x86_64-linux-thread-multi# Can't locate ExtUtils/Embed.pm in @INC (you may need to install the ExtUtils::Embed module).......# 此时执行：sudo dnf -y install perl-devel perl-ExtUtils-Embed# the HTTP image filter module requires the GD library# 执行sudo dnf -y install gd gd-devel</code></pre><h4 id="5-4-cp-so-文件"><a href="#5-4-cp-so-文件" class="headerlink" title="5.4 cp .so 文件"></a>5.4 cp .so 文件</h4><p>上一步执行完成后， 会在  nginx 下的 objs 目中中生成 </p><p><code>ngx_http_brotli_filter_module.so</code>   和 <code>ngx_http_brotli_static_module.so</code> </p><p>目标文件，我们把他们移动到原 nginx 的 mudule 中。 </p><p>先在 nginx.conf 中看 modules.conf 在哪里：</p><p><code>include /usr/share/nginx/modules/*.conf;</code>  说明所有的 module 配置文件都在这个目录下。</p><p>然后去这个目录，随便 cat 一个配置文件， 会输出：</p><blockquote><p>load_module “/usr/lib64/nginx/modules/ngx_http_brotli_filter_module.so”;</p></blockquote><p>此时能看到，所有 module 的 .so 文件，都在这个地方，我们把这两个 <code>.so</code> 也 cp 这个目录</p><p>当然， 你也可以放入任何你想放的位置，然后在编写 .conf 的时候，指定路径就好了。</p><h4 id="5-5-编写-conf-文件"><a href="#5-5-编写-conf-文件" class="headerlink" title="5.5 编写 .conf 文件"></a>5.5 编写 .conf 文件</h4><p>移动完成后，同样的，我们在 modules 目录下，创建两个文件：</p><p> <code>mod-http-brotli-filter.conf</code>  和 <code>mod-http-brotli-static.conf</code> </p><p>内容分别为：</p><blockquote><p>load_module “/usr/lib64/nginx/modules/ngx_http_brotli_filter_module.so”;</p><p>和</p><p>load_module “/usr/lib64/nginx/modules/ngx_http_brotli_static_module.so”;</p></blockquote><p>当然，以上所有的路径，都以你实际的目录为准</p><h4 id="5-6-重启和验证"><a href="#5-6-重启和验证" class="headerlink" title="5.6 重启和验证"></a>5.6 重启和验证</h4><p><code>sudo nginx -t</code>  输出 ok 后 <code>sudo systemctl restart nginx</code>  </p><p>这时通过页面访问，能看到 br 即说明 ok</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://img.iyuhp.top/blog/20200401081528.png-growing" alt="image-20200401081526690"></p><h3 id="6-blog-conf-配置-启用-http2"><a href="#6-blog-conf-配置-启用-http2" class="headerlink" title="6. blog conf 配置[启用 http2]"></a>6. blog conf 配置[启用 http2]</h3><pre class=" language-nginx"><code class="language-nginx"><span class="token keyword">server</span> <span class="token punctuation">{</span>        <span class="token keyword">listen</span>       <span class="token number">80</span><span class="token punctuation">;</span>        <span class="token keyword">server_name</span>  iyuhp<span class="token punctuation">.</span>top<span class="token punctuation">;</span>        <span class="token keyword">proxy_set_header</span> Host <span class="token variable">$host</span><span class="token punctuation">;</span>        <span class="token keyword">proxy_set_header</span> X<span class="token operator">-</span>Real<span class="token operator">-</span>IP <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>        <span class="token keyword">proxy_set_header</span> REMOTE<span class="token operator">-</span>HOST <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>        <span class="token keyword">proxy_set_header</span> X<span class="token operator">-</span>Forwarded<span class="token operator">-</span>For <span class="token variable">$proxy_add_x_forwarded_for</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token number">301</span> <span class="token keyword">https</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token variable">$host</span><span class="token variable">$request_uri</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>  <span class="token keyword">server</span> <span class="token punctuation">{</span>    <span class="token keyword">listen</span> <span class="token number">443</span> <span class="token keyword">ssl</span> http2<span class="token punctuation">;</span>    <span class="token keyword">listen</span> <span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token number">443</span> <span class="token keyword">ssl</span> http2<span class="token punctuation">;</span>    <span class="token keyword">server_name</span> iyuhp<span class="token punctuation">.</span>top<span class="token punctuation">;</span>    <span class="token keyword">try_files</span> <span class="token variable">$uri</span> <span class="token operator">/</span><span class="token keyword">index</span><span class="token punctuation">.</span>html<span class="token punctuation">;</span>    <span class="token keyword">proxy_set_header</span> Host <span class="token variable">$host</span><span class="token punctuation">;</span>    <span class="token keyword">proxy_set_header</span> X<span class="token operator">-</span>Real<span class="token operator">-</span>IP <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>    <span class="token keyword">proxy_set_header</span> REMOTE<span class="token operator">-</span>HOST <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>    <span class="token keyword">proxy_set_header</span> X<span class="token operator">-</span>Forwarded<span class="token operator">-</span>For <span class="token variable">$proxy_add_x_forwarded_for</span><span class="token punctuation">;</span>    <span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">{</span>        <span class="token keyword">root</span>            <span class="token operator">/</span>usr<span class="token operator">/</span>share<span class="token operator">/</span>nginx<span class="token operator">/</span>html<span class="token operator">/</span>growing<span class="token operator">-</span>blog<span class="token operator">/</span>public<span class="token punctuation">;</span>        <span class="token keyword">index</span>           <span class="token keyword">index</span><span class="token punctuation">.</span>html <span class="token keyword">index</span><span class="token punctuation">.</span>htm<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">location</span> <span class="token operator">=</span> <span class="token operator">/</span>favicon<span class="token punctuation">.</span>png <span class="token punctuation">{</span>            <span class="token keyword">expires</span>     30d<span class="token punctuation">;</span>            <span class="token keyword">access_log</span>  off<span class="token punctuation">;</span>            <span class="token keyword">root</span>        <span class="token operator">/</span>usr<span class="token operator">/</span>share<span class="token operator">/</span>nginx<span class="token operator">/</span>html<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">location</span> <span class="token operator">~</span><span class="token operator">*</span> <span class="token operator">^</span><span class="token punctuation">.</span><span class="token operator">*</span>\<span class="token punctuation">.</span><span class="token punctuation">(</span>gif<span class="token operator">|</span>jpg<span class="token operator">|</span>jpeg<span class="token operator">|</span>png<span class="token operator">|</span>bmp<span class="token operator">|</span>swf<span class="token punctuation">)</span>$ <span class="token punctuation">{</span>            <span class="token keyword">expires</span>     15d<span class="token punctuation">;</span>            <span class="token keyword">access_log</span>  off<span class="token punctuation">;</span>            <span class="token keyword">root</span>        <span class="token operator">/</span>usr<span class="token operator">/</span>share<span class="token operator">/</span>nginx<span class="token operator">/</span>html<span class="token operator">/</span>growing<span class="token operator">-</span>blog<span class="token operator">/</span>public<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true"># js/css 等，我们已经托管到 jsDelivr ，这里就不用再配置了</span>    <span class="token keyword">access_log</span>  <span class="token operator">/</span>var<span class="token operator">/</span>log<span class="token operator">/</span>nginx<span class="token operator">/</span>growing<span class="token operator">-</span>blog<span class="token operator">/</span>access<span class="token punctuation">.</span>log  main<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>我们在 listen 的时候，如上图配置 http2 即可，无需 <code>ssl on</code>  </p><p>剩下都是常规配置， 没什么好说的， 无非是给一些静态文件添加缓存，这个根据实际情况配置就好。</p><p>我们打开控制台，能看到 <em>Protocol</em>  一栏，都显示为 <em>h2</em> ，说明配置生效</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://img.iyuhp.top/blog/20200401082103.png-growing" alt="image-20200401082101525"></p><h4 id="7-开启-OSCP"><a href="#7-开启-OSCP" class="headerlink" title="7.  开启 OSCP"></a>7.  开启 OSCP</h4><pre class=" language-shell"><code class="language-shell"># TODO 开启 oscpssl_stapling      on;ssl_stapling_verify       on;ssl_trusted_certificate   ospc_file_path</code></pre><p>有兴趣的童鞋可以开启试下， 这里注意下，你要先生成 trusted certificate file ， 这个 file 有过期时间，所以你需要一个 cronjob 来定时更新它，反正我没有开启它。。。</p><h2 id="图床"><a href="#图床" class="headerlink" title="图床"></a>图床</h2><p>使用七牛云作为图床， 七牛云注册后，会送 10G 的免费 OSS，作为一些图片的存放点，十分合适(是的，我就是这样薅羊毛的！)</p><ul><li><a href="https://uploader.iyuhp.top" target="_blank" rel="noopener">Uploader 链接</a></li><li><a href="https://gitee.com/iyuhp-growing/growing-backend/tree/develop/qnyun" target="_blank" rel="noopener">Gitee 仓库</a></li></ul><p>实现概览：</p><ol><li>使用 golang 搭建一个简单的 web server，主要负责登录验证和分发七牛云 OSS 的上传 Token</li><li>前端使用 <a href="https://www.dropzonejs.com/" target="_blank" rel="noopener">Dropzone</a> js 组件来实现上传</li><li>使用七牛云的 <a href="https://developer.qiniu.com/kodo/api/1312/upload" target="_blank" rel="noopener">Http Upload</a> 方式上传图片，token 从 web sever 拿，上传不经过 web server</li></ol><p>嗯， 今天突然发现了一个功能完备的上传工具 <a href="https://github.com/Molunerfinn/PicGo" target="_blank" rel="noopener">PicGO</a> ，不过我肯定还是用我自己的这个了，啊哈哈哈</p><h2 id="CICD"><a href="#CICD" class="headerlink" title="CICD"></a>CICD</h2><p>如果不是和我一样，搞了很多乱七八糟的，无论是 github ， 还是 gitee，都提供了基于 hexo 的 cicd，只需要在自己的 _config.yml 中配置下 deploy (可能需要添加一个 .travis.yml)  </p><p>我个人基于 Golang ，自己定制了一个 cicd 流程。</p><p>通过 gitee 的 push hooks event， 拉取最新代码，然后执行 blog 中 build.sh 脚本，脚本主要做了这几件事情</p><ul><li>打印 hexo 版本</li><li>执行 npm i</li><li>执行 gulp default , 进行编译压缩静态文件</li><li>移动文件到指定目录</li></ul><p>执行完后， cicd 会检测是否需要提交到 github，如果需要，会执行 git add git commit git push 一系列命令，执行完毕后，整个流程就结束。</p><p>对于我的 uploader ， cicd 首先会拉取代码，打包镜像，之后会通过 docker ps 查看是否有进程，有的话会杀死，是的，就是这么霸道，完全没有那么一丝丝的平滑，杀死后，会把新的镜像拉起来，整个流程结束。<br>本来准备打算加个通知功能，不过暂时没有时间做。</p><p>还有，十分重要的就是， 所有的操作都在同一个目录，cicd 每一次执行，都会开一个协程，这必然会产生写文件冲突，考虑到只有我一个人用，并不打算改这里。</p><p>改进也很简单，就是每次 cicd 的时候，都产生一个新目录，只拉取最新代码，然后在各自的目录中去做事就好了。完事儿把目录删掉！</p><p>可是考虑到我那 1C1G 50G 的可怜资源，哎，算了，咱不折腾！！！</p><h2 id="写文章"><a href="#写文章" class="headerlink" title="写文章"></a>写文章</h2><p>windows 下，实际体验下来，还是用  <a href="https://www.typora.io/" target="_blank" rel="noopener">Typora</a> + <a href="https://github.com/PicGo" target="_blank" rel="noopener">PicGo</a> 来的舒服</p><p>前面刚说完</p><blockquote><p>不过我肯定是用我自己的这个了</p></blockquote><p>嗯， 真香……</p><p>所以我自己的，就平时用来存存图片啥的好了，反正都撸出来了不是！</p><h2 id="TODO"><a href="#TODO" class="headerlink" title="TODO"></a>TODO</h2><h3 id="1-bing-爬虫"><a href="#1-bing-爬虫" class="headerlink" title="1. bing 爬虫"></a>1. bing 爬虫</h3><p>通过爬虫爬取 bing 首页图片，放到 banner 中</p><h3 id="2-撸一个简单的-devops"><a href="#2-撸一个简单的-devops" class="headerlink" title="2. 撸一个简单的 devops"></a>2. <del>撸一个简单的 devops</del></h3><p>本地提交代码到 gitee 后， ecs 来去代码打包部署</p><h3 id="3-七牛云图床"><a href="#3-七牛云图床" class="headerlink" title="3. 七牛云图床"></a>3. <del>七牛云图床</del></h3><p>搞一个上传界面，用来存储图片，同时获取图片路径</p><h2 id="ISSUE"><a href="#ISSUE" class="headerlink" title="ISSUE"></a>ISSUE</h2><h3 id="Q1-打开的文章页面，都变成了下载页面…"><a href="#Q1-打开的文章页面，都变成了下载页面…" class="headerlink" title="Q1 打开的文章页面，都变成了下载页面…"></a>Q1 打开的文章页面，都变成了下载页面…</h3><p>A：在 _config.yml 中 permalink ， 一定要注意结尾加上斜杠(/) !!! like this： <code>:title/</code></p><h3 id="Q2-Local-hexo-not-found-in-xxx"><a href="#Q2-Local-hexo-not-found-in-xxx" class="headerlink" title="Q2 Local hexo not found in xxx"></a>Q2 Local hexo not found in xxx</h3><pre><code>ERROR Local hexo not found in xxxERROR Try running: 'npm install hexo --save'</code></pre><p>A： 开玩笑， 明明已经跑了命令 <code>sudo npm install -g hexo-cli</code> ， 你还给我提示这个？</p><p>对我而言， 我是因为新 clone 下来的文件， 还没执行 <code>npm i</code> ， 执行后， 就 ok 了。</p><p>但是搜解决方案的时候，有人说是因为 node_modules 的问题，要删了重新 <code>npm i</code> ，可以一试。</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blog </tag>
            
            <tag> nginx </tag>
            
            <tag> https </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>OAUTH2 Protocol</title>
      <link href="/others/oauth/"/>
      <url>/others/oauth/</url>
      
        <content type="html"><![CDATA[<h1 id="oauth2"><a href="#oauth2" class="headerlink" title="oauth2"></a>oauth2</h1><h2 id="oauth2-介绍"><a href="#oauth2-介绍" class="headerlink" title="oauth2 介绍"></a>oauth2 介绍</h2><p><a href="https://tools.ietf.org/html/rfc6749" target="_blank" rel="noopener">OATUH 2.0 RFC</a></p><p><a href="http://www.ruanyifeng.com/blog/2014/05/oauth_2_0.html" target="_blank" rel="noopener">OATUH 2.0 科普</a></p><h2 id="oauth2-的四种授权模式"><a href="#oauth2-的四种授权模式" class="headerlink" title="oauth2 的四种授权模式"></a>oauth2 的四种授权模式</h2><h3 id="授权码授权模式-Authorization-Code-Grant"><a href="#授权码授权模式-Authorization-Code-Grant" class="headerlink" title="授权码授权模式(Authorization Code Grant)"></a>授权码授权模式(Authorization Code Grant)</h3><p>参见 <a href="https://tools.ietf.org/html/rfc6749#section-4.1" target="_blank" rel="noopener">RFC Code Grant</a></p><h4 id="流程图"><a href="#流程图" class="headerlink" title="流程图"></a>流程图</h4><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://img.iyuhp.top/blog/20200401092604.png-growing" alt="code grant flow"></p><p>如图示</p><ul><li>client 为用户</li><li>user-agent 一般指浏览器</li><li>resource owner: 资源拥有者</li><li>Authorization Server: 认证服务器</li></ul><h4 id="步骤解释"><a href="#步骤解释" class="headerlink" title="步骤解释"></a>步骤解释</h4><h5 id="A"><a href="#A" class="headerlink" title="A)"></a>A)</h5><p>客户端通过代理(web browser) 向资源服务器请求资源，user agent 代理到授权服务器。这一步，请求链接一般长这个样子：</p><pre><code>https://xxx.com/oauth/authorize?  response_type=code&amp;  client_id=xxx&amp;  redirect_uri=client_call_uri&amp;  scope=base&amp;  state=xxx</code></pre><ul><li>response_type:  指定授权类型，这里固定为 <code>code</code> (下面会有 password，token, client_credentials)</li><li>client_id: 客户 id， 表明请求人身份</li><li>redirect_uri: 授权后重定向的地址</li><li>scope: 授权范围</li><li>state: 重定向后，会原样返回， 可以用来防止 csrf 攻击</li></ul><h5 id="B"><a href="#B" class="headerlink" title="B)"></a>B)</h5><p>授权服务器要对资源所有者进行身份认证并确认资源所有者是授予还是拒绝该请求。</p><h5 id="C"><a href="#C" class="headerlink" title="C)"></a>C)</h5><p>授权服务器跳转 redirect_uri ， 同时附带一个授权码(code): <code>https://redirect_uri?code=xxx&amp;state=xxx</code></p><h5 id="D"><a href="#D" class="headerlink" title="D)"></a>D)</h5><p>用户根据这个 code ， 请求 token， 这步的链接一般长这个样子：</p><pre><code>https://xxx/oauth/token? grant_type=authorization_code&amp; code=xxx&amp; redirect_uri=xxx&amp; client_id=xxx&amp; client_secret=xxx</code></pre><ul><li><p>grant_type: 授权类型， 这里固定为 <code>authorization_code</code></p></li><li><p>code: 就是你刚刚拿到的 code</p></li><li><p>redirect_uri: 这一步要保证这里的 uri 和之前的 uri 一致</p></li><li><p>client_id &amp; client_secret :  身份验证</p></li></ul><h5 id="E"><a href="#E" class="headerlink" title="E)"></a>E)</h5><p>返回 access token， (或者带上 refresh token)</p><pre class=" language-json"><code class="language-json">HTTP/<span class="token number">1.1</span> <span class="token number">200</span> OKContent-Type<span class="token operator">:</span> application/json<span class="token punctuation">;</span>charset=UTF<span class="token number">-8</span>Cache-Control<span class="token operator">:</span> no-storePragma<span class="token operator">:</span> no-cache<span class="token punctuation">{</span>    <span class="token property">"access_token"</span><span class="token operator">:</span><span class="token string">"2YotnFZFEjr1zCsicMWpAA"</span><span class="token punctuation">,</span>    <span class="token property">"token_type"</span><span class="token operator">:</span><span class="token string">"example"</span><span class="token punctuation">,</span>    <span class="token property">"expires_in"</span><span class="token operator">:</span><span class="token number">3600</span><span class="token punctuation">,</span>    <span class="token property">"refresh_token"</span><span class="token operator">:</span><span class="token string">"tGzv3JOkF0XG5Qx2TlKWIA"</span><span class="token punctuation">,</span>    <span class="token property">"example_parameter"</span><span class="token operator">:</span><span class="token string">"example_value"</span><span class="token punctuation">}</span></code></pre><h3 id="隐藏授权模式-Implicit-Grant"><a href="#隐藏授权模式-Implicit-Grant" class="headerlink" title="隐藏授权模式(Implicit Grant)"></a>隐藏授权模式(Implicit Grant)</h3><p><a href="https://tools.ietf.org/html/rfc6749#section-4.2" target="_blank" rel="noopener">https://tools.ietf.org/html/rfc6749#section-4.2</a></p><p>略</p><h3 id="密码授权模式-Resource-Owner-Password-Credentials-Grant"><a href="#密码授权模式-Resource-Owner-Password-Credentials-Grant" class="headerlink" title="密码授权模式(Resource Owner Password Credentials Grant)"></a>密码授权模式(Resource Owner Password Credentials Grant)</h3><p><a href="https://tools.ietf.org/html/rfc6749#section-4.3" target="_blank" rel="noopener">https://tools.ietf.org/html/rfc6749#section-4.3</a></p><p>略</p><h3 id="客户端凭证授权模式-Client-Credentials-Grant"><a href="#客户端凭证授权模式-Client-Credentials-Grant" class="headerlink" title="客户端凭证授权模式(Client Credentials Grant)"></a>客户端凭证授权模式(Client Credentials Grant)</h3><p><a href="https://tools.ietf.org/html/rfc6749#section-4.4" target="_blank" rel="noopener">https://tools.ietf.org/html/rfc6749#section-4.4</a></p><p>略</p><h2 id="微信示例"><a href="#微信示例" class="headerlink" title="微信示例"></a>微信示例</h2><p><a href="https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/Wechat_webpage_authorization.html#0" target="_blank" rel="noopener">微信 OAUTH 2.0 对接文档</a></p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://img.iyuhp.top/blog/20200401093011.png-growing" alt="wechat oauth2 flow"></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> others </category>
          
      </categories>
      
      
        <tags>
            
            <tag> protocol </tag>
            
            <tag> network </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux 基础环境搭建安装指北</title>
      <link href="/linux/install/"/>
      <url>/linux/install/</url>
      
        <content type="html"><![CDATA[<h1 id="Linux-基础环境安装指北"><a href="#Linux-基础环境安装指北" class="headerlink" title="Linux 基础环境安装指北"></a>Linux 基础环境安装指北</h1><p><a href="https://opsx.alibaba.com/mirror" target="_blank" rel="noopener">阿里巴巴开源站点</a>  </p><p>个人安装环境为 <code>CentOS Linux release 7.6.1810 (Core)</code> </p><h2 id="zsh-amp-oh-my-zsh"><a href="#zsh-amp-oh-my-zsh" class="headerlink" title="zsh &amp; oh my zsh"></a>zsh &amp; oh my zsh</h2><ul><li><a href="https://github.com/robbyrussell/oh-my-zsh/wiki/Installing-ZSH" target="_blank" rel="noopener">zsh 安装</a> </li></ul><pre class=" language-bash"><code class="language-bash"><span class="token function">sudo</span> yum -y update <span class="token operator">&amp;&amp;</span> <span class="token function">sudo</span> yum -y <span class="token function">install</span> zsh</code></pre><ul><li><a href="https://github.com/robbyrussell/oh-my-zsh" target="_blank" rel="noopener">oh my zsh 安装</a></li></ul><pre class=" language-bash"><code class="language-bash">sh -c <span class="token string">"<span class="token variable"><span class="token variable">$(</span>curl -fsSL https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh<span class="token variable">)</span></span>"</span></code></pre><ul><li><a href="https://github.com/powerline/fonts" target="_blank" rel="noopener">powerline 安装</a></li></ul><pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># install git if not exist</span><span class="token function">sudo</span> yum <span class="token function">install</span> -y <span class="token function">git</span><span class="token function">git</span> clone https://github.com/powerline/fonts.git --depth<span class="token operator">=</span>1<span class="token function">cd</span> fonts./install.sh<span class="token function">cd</span> <span class="token punctuation">..</span><span class="token function">rm</span> -fr fonts</code></pre><h2 id="add-user"><a href="#add-user" class="headerlink" title="add user"></a>add user</h2><pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 添加用户</span>adduser dylan<span class="token comment" spellcheck="true"># 添加密码</span><span class="token function">passwd</span> dylan<span class="token comment" spellcheck="true"># sudo 命令添加</span><span class="token comment" spellcheck="true"># sudoers 文件查找</span><span class="token function">whereis</span> sudoers<span class="token comment" spellcheck="true">#添加时， 要注意 sudoers 文件是只读的， 先修改为可写，修改完成后再变为可读</span><span class="token function">chmod</span> -v u+w /etc/sudoers<span class="token function">chmod</span> -v u-w /etc/sudoers<span class="token comment" spellcheck="true"># 查看组</span><span class="token function">sudo</span> <span class="token function">cat</span> /etc/group <span class="token operator">|</span> <span class="token function">grep</span> wheel<span class="token comment" spellcheck="true"># 添加一个新组 group-test</span><span class="token function">sudo</span> <span class="token function">groupadd</span> group-test <span class="token comment" spellcheck="true"># 将登陆用户加入到 wheel 用户组中， -a : append</span><span class="token function">sudo</span> gpasswd -a <span class="token variable">$USER</span> wheel  <span class="token comment" spellcheck="true"># 更新 wheel 组</span>newgrp wheel  </code></pre><p>这里不建议直接将用于赋予 root 权限，一般的做法是放开 wheel 组，将用户添加到 wheel 组，通过 <code>visudo</code>  命令打开 /etc/sudoers , 将</p><blockquote><p>#Allows people in group wheel to run all commands</p><p>#%wheel  ALL=(ALL)       ALL</p></blockquote><p>中 %wheel 前的 # 去掉， 然后将用户添加到 wheel 组。</p><h2 id="iptables"><a href="#iptables" class="headerlink" title="iptables"></a>iptables</h2><ol><li>开/重启/开机自启动</li></ol><pre class=" language-bash"><code class="language-bash"><span class="token function">sudo</span> systemctl start iptables<span class="token function">sudo</span> systemctl restart iptables<span class="token function">sudo</span> systemctl <span class="token function">enable</span> iptables</code></pre><ol start="2"><li>编辑 iptables 文件</li></ol><p>在 <strong><code>/etc/sysconfig/iptables</code></strong>  文件中添加规则</p><h2 id="配置免密登录"><a href="#配置免密登录" class="headerlink" title="配置免密登录"></a>配置免密登录</h2><h3 id="1-生成-ssh-秘钥"><a href="#1-生成-ssh-秘钥" class="headerlink" title="1. 生成 ssh 秘钥"></a>1. 生成 ssh 秘钥</h3><p>参考 <a href="https://www.cnblogs.com/yanglang/p/9563496.html" target="_blank" rel="noopener">这里</a></p><pre class=" language-bash"><code class="language-bash">ssh-keygen -t rsa -C <span class="token string">"peifeng"</span> -f filepath</code></pre><ul><li>-t 指定密钥类型，默认是 rsa ，可以省略。</li><li>-C 设置注释文字，比如邮箱。</li><li>-f 指定密钥文件存储文件名。默认为 ~.ssh/ 目录<h3 id="2-配置免密登录"><a href="#2-配置免密登录" class="headerlink" title="2. 配置免密登录"></a>2. 配置免密登录</h3></li></ul><p>A 机器免密登录到 B 机器， 默认都已生成 ssh 秘钥。</p><ol><li>登录 A 机器，运行命令 ssh-copy-id 发送本地 id_rsa.pub 到 B 机器的 ~/.ssh/authorized_keys 文件中<pre class=" language-bash"><code class="language-bash">ssh-copy-id dylan@B_ip</code></pre></li></ol><ol start="2"><li>配置 A 机器的 ~/.ssh/config 文件(如果没有， 请自己添加， 注意该文件的权限至少为 600 )。 参考 <a href="https://www.cnblogs.com/lingyejun/p/7367596.html" target="_blank" rel="noopener">这里</a><pre><code>Host A_alias HostName B_machine_ip User dylan Port 22 IdentityFile ~/.ssh/id_rsa</code></pre></li></ol><ul><li>Host 别名， 登录时， 直接通过该别名登录</li><li>HostName： 主机名或主机 ip</li><li>User： 登录的用户名</li><li>Port： 端口</li><li>IdentityFile： 秘钥文件路径</li></ul><ol start="3"><li>登录</li></ol><pre class=" language-bash"><code class="language-bash"><span class="token function">ssh</span> A_alias</code></pre><h2 id="docker-install"><a href="#docker-install" class="headerlink" title="docker install"></a>docker install</h2><p>参考 </p><ul><li><p><a href="https://docs.docker.com/install/linux/docker-ce/centos/" target="_blank" rel="noopener">https://docs.docker.com/install/linux/docker-ce/centos/</a> </p></li><li><p>stable 列表： <a href="https://download.docker.com/linux/centos/7/x86_64/stable/Packages/" target="_blank" rel="noopener">https://download.docker.com/linux/centos/7/x86_64/stable/Packages/</a></p></li><li><p>阿里云 stable 列表： <a href="https://mirrors.aliyun.com/docker-ce/linux/centos/7/x86_64/stable/Packages/" target="_blank" rel="noopener">https://mirrors.aliyun.com/docker-ce/linux/centos/7/x86_64/stable/Packages/</a></p></li></ul><h3 id="1-通过-docker-源-安装"><a href="#1-通过-docker-源-安装" class="headerlink" title="1. 通过 docker 源 安装"></a>1. 通过 docker 源 安装</h3><h4 id="1-1-移除老版本，-如果是第一次安装，-可以忽略"><a href="#1-1-移除老版本，-如果是第一次安装，-可以忽略" class="headerlink" title="1.1 移除老版本， 如果是第一次安装， 可以忽略"></a>1.1 移除老版本， 如果是第一次安装， 可以忽略</h4><pre class=" language-bash"><code class="language-bash"><span class="token function">sudo</span> yum remove docker \                  docker-client \                  docker-client-latest \                  docker-common \                  docker-latest \                  docker-latest-logrotate \                  docker-logrotate \                  docker-engine</code></pre><h4 id="1-2-安装必要的工具"><a href="#1-2-安装必要的工具" class="headerlink" title="1.2 安装必要的工具"></a>1.2 安装必要的工具</h4><p><code>yum-utils</code> provides the <code>yum-config-manager</code> utility, and <code>device-mapper-persistent-data</code> and <code>lvm2</code>are required by the <code>devicemapper</code> storage driver.</p><pre class=" language-bash"><code class="language-bash"><span class="token function">sudo</span> yum <span class="token function">install</span> -y yum-utils \  device-mapper-persistent-data \  lvm2</code></pre><h4 id="1-3-设置可用的-docker-ce-repository"><a href="#1-3-设置可用的-docker-ce-repository" class="headerlink" title="1.3 设置可用的 docker-ce repository"></a>1.3 设置可用的 docker-ce repository</h4><pre class=" language-bash"><code class="language-bash"><span class="token function">sudo</span> yum-config-manager \    --add-repo \    https://download.docker.com/linux/centos/docker-ce.repo <span class="token comment" spellcheck="true">## 这里可以使用阿里云的 docker repo</span> <span class="token function">sudo</span> yum-config-manager \ --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo<span class="token function">sudo</span> yum makecache fast</code></pre><h4 id="1-4-安装最新版-docker-ce，-containerd"><a href="#1-4-安装最新版-docker-ce，-containerd" class="headerlink" title="1.4 安装最新版 docker-ce， containerd"></a>1.4 安装最新版 docker-ce， containerd</h4><pre class=" language-bash"><code class="language-bash"><span class="token function">sudo</span> yum -y <span class="token function">install</span> docker-ce docker-ce-cli containerd.io<span class="token comment" spellcheck="true">## 可以指定版本安装</span><span class="token function">sudo</span> yum -y <span class="token function">install</span> docker-ce-19.03.0 docker-ce-cli-19.03.0 containerd.io<span class="token comment" spellcheck="true">## 安装过程中可能会出现 containerd.io > xxx 的提示， 可以先安装 containerd</span><span class="token comment" spellcheck="true">## https://download.docker.com/linux/centos/7/x86_64/stable/Packages/</span><span class="token comment" spellcheck="true">## 到官网查找版本后执行如下命令 (centos8)</span><span class="token function">sudo</span> dnf <span class="token function">install</span> https://download.docker.com/linux/centos/7/x86_64/stable/Packages/containerd.io-1.2.6-3.3.el7.x86_64.rpm<span class="token comment" spellcheck="true">## 再安装 docker-ce 和 docker-ce-cli</span><span class="token function">sudo</span> yum -y <span class="token function">install</span> docker-ce docker-ce-cli</code></pre><h4 id="1-5-开启-docker"><a href="#1-5-开启-docker" class="headerlink" title="1.5 开启 docker"></a>1.5 开启 docker</h4><pre class=" language-bash"><code class="language-bash"><span class="token function">sudo</span> systemctl start docker</code></pre><h4 id="1-6-验证是否成功"><a href="#1-6-验证是否成功" class="headerlink" title="1.6 验证是否成功"></a>1.6 验证是否成功</h4><pre class=" language-bash"><code class="language-bash">docker run hello-world</code></pre><h4 id="1-7-使用阿里云镜像加速器"><a href="#1-7-使用阿里云镜像加速器" class="headerlink" title="1.7 使用阿里云镜像加速器"></a>1.7 使用阿里云镜像加速器</h4><p><a href="https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors" target="_blank" rel="noopener">https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors</a></p><pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 1. 创建目录， 如果存在请忽略</span><span class="token function">sudo</span> <span class="token function">mkdir</span> -p /etc/docker<span class="token comment" spellcheck="true"># 2. 写入阿里云 registry</span><span class="token function">sudo</span> <span class="token function">tee</span> /etc/docker/daemon.json <span class="token operator">&lt;&lt;</span>-<span class="token string">'EOF'</span><span class="token punctuation">{</span>  <span class="token string">"registry-mirrors"</span><span class="token keyword">:</span> <span class="token punctuation">[</span><span class="token string">"你的加速地址"</span><span class="token punctuation">]</span><span class="token punctuation">}</span>EOF<span class="token comment" spellcheck="true"># 3. 重启</span><span class="token function">sudo</span> systemctl daemon-reload<span class="token function">sudo</span> systemctl restart docker</code></pre><h4 id="1-8-免-sudo-使用-docker"><a href="#1-8-免-sudo-使用-docker" class="headerlink" title="1.8 免 sudo 使用 docker"></a>1.8 免 sudo 使用 docker</h4><p>当我们运行如 <code>docker info</code> 时， 会报如下错误(非 root 用户)</p><pre><code>Got permission denied while trying to connect to the Docker daemon socket at unix:///var/run/docker.sock: Get http://%2Fvar%2Frun%2Fdocker.sock/v1.39/info: dial unix /var/run/docker.sock: connect: permission denied</code></pre><p>原因：</p><blockquote><p>Manage Docker as a non-root user</p><p>The docker daemon binds to a Unix socket instead of a TCP port. By default that Unix socket is owned by the user root and other users can only access it using sudo. The docker daemon always runs as the root user.</p><p>If you don’t want to use sudo when you use the docker command, create a Unix group called docker and add users to it. When the docker daemon starts, it makes the ownership of the Unix socket read/writable by the docker group.</p></blockquote><p>大意为： docker 进程使用 Unix Socket 而不是 TCP 端口。而默认情况下，Unix socket 属于 root 用户，需要 root 权限才能访问。</p><blockquote><p><strong>docker 守护进程启动的时候，会默认赋予名字为 docker 的用户组读写 Unix socket 的权限，因此只要创建 docker 用户组，并将当前用户加入到 docker 用户组中，那么当前用户就有权限访问 Unix socket 了，进而也就可以执行 docker 相关命令</strong></p></blockquote><p>解决办法</p><pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 查看 docker 用户组是否已存在</span><span class="token function">sudo</span> <span class="token function">cat</span> /etc/group <span class="token operator">|</span> <span class="token function">grep</span> docker <span class="token comment" spellcheck="true"># 添加docker用户组， 如果 docker 用户组已存在， 则不需执行</span><span class="token function">sudo</span> <span class="token function">groupadd</span> docker <span class="token comment" spellcheck="true"># 将登陆用户加入到 docker 用户组中， -a : append</span><span class="token function">sudo</span> gpasswd -a <span class="token variable">$USER</span> docker  <span class="token comment" spellcheck="true"># 更新用户组</span>newgrp docker  <span class="token comment" spellcheck="true"># 测试 docker 命令是否可以在无 sudo 时正常使用</span>docker info  </code></pre><h3 id="2-通过安装包安装"><a href="#2-通过安装包安装" class="headerlink" title="2. 通过安装包安装"></a>2. 通过安装包安装</h3><ol><li>通过 <a href="https://download.docker.com/linux/centos/7/x86_64/stable/Packages/" target="_blank" rel="noopener">https://download.docker.com/linux/centos/7/x86_64/stable/Packages/</a> 获取你需要的版本的 <code>.rpm</code> 安装包文件</li><li>安装</li></ol><pre class=" language-bash"><code class="language-bash"><span class="token function">sudo</span> yum <span class="token function">install</span> /path/to/package.rpm</code></pre><ol start="3"><li>运行 docker</li></ol><pre class=" language-bash"><code class="language-bash"><span class="token function">sudo</span> systemctl start docker</code></pre><ol start="4"><li>验证</li></ol><pre class=" language-bash"><code class="language-bash"><span class="token function">sudo</span> docker run hello-world</code></pre><h3 id="3-通过安装脚本安装"><a href="#3-通过安装脚本安装" class="headerlink" title="3. 通过安装脚本安装"></a>3. 通过安装脚本安装</h3><pre class=" language-bash"><code class="language-bash">curl -fsSL https://get.docker.com -o get-docker.sh<span class="token function">sudo</span> sh get-docker.sh</code></pre><h2 id="docker-uninstall-upgrade"><a href="#docker-uninstall-upgrade" class="headerlink" title="docker uninstall/upgrade"></a>docker uninstall/upgrade</h2><pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 卸载 docker</span><span class="token function">sudo</span> yum remove docker-ce<span class="token comment" spellcheck="true"># 删除 images/volumes/containers 等</span><span class="token function">sudo</span> <span class="token function">rm</span> -rf /var/lib/docker</code></pre><p>上面是官方文档的说法， 实际操作中，可能会出现 client 和 server 版本不一致的问题，可以先都删除掉</p><pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 查找已安装的 docker 相关软件包</span>rpm -qa <span class="token operator">|</span> <span class="token function">grep</span> docker<span class="token comment" spellcheck="true"># 卸载列出的软件包</span> <span class="token function">sudo</span> yum remove docker-ce-cli-19.03.0-3.el7.x86_64 docker-ce-19.03.0-3.el7.x86_64 <span class="token comment" spellcheck="true"># 之后安装需要的版本即可</span> <span class="token function">sudo</span> yum -y <span class="token function">install</span> docker-ce-18.09.8 docker-ce-cli-18.09.8 containerd.io <span class="token comment" spellcheck="true"># 安装完成后， 启动 docker</span> <span class="token function">sudo</span> systemctl start docker <span class="token comment" spellcheck="true"># 启动所有容器</span> docker restart <span class="token variable"><span class="token variable">$(</span>docker <span class="token function">ps</span> -aq<span class="token variable">)</span></span> <span class="token comment" spellcheck="true"># 检查容器状态！</span> <span class="token function">sudo</span> systemctl status docker</code></pre><h3 id="附：-docker-clean"><a href="#附：-docker-clean" class="headerlink" title="附： docker clean"></a>附： docker clean</h3><pre class=" language-shell"><code class="language-shell"># 类似 linux 的 df, docker 会展示 docker 的磁盘使用情况docker system df# docker 的默认存盘目录一般在 /var/lib/docker 下， 可以进去看具体情况# 该命令可以用来清理磁盘，删除关闭的容器，无用的 volume 和 network# 包括 dangling(无 tag) 镜像 以及 cache# 该命令还可以加 -a ，会把所有没有 container 关联的 image 都删掉，千万慎用！！！docker system prune</code></pre><h2 id="v2ray-amp-ss（vultr）"><a href="#v2ray-amp-ss（vultr）" class="headerlink" title="v2ray &amp; ss（vultr）"></a>v2ray &amp; ss（vultr）</h2><p>使用 vultr ecs 时，一般用来搭建自己的梯子，现在比较常用的有 v2ray &amp; ss 。</p><ul><li><a href="https://raw.githubusercontent.com/233boy/v2ray/master/install.sh" target="_blank" rel="noopener">https://raw.githubusercontent.com/233boy/v2ray/master/install.sh</a></li></ul><p>可参考 github 上各类一键安装脚本。</p><h2 id="NGINX"><a href="#NGINX" class="headerlink" title="NGINX"></a>NGINX</h2><p>nginx 不在默认的 yum 源中，所以第一步加入</p><h3 id="1-安装"><a href="#1-安装" class="headerlink" title="1. 安装"></a>1. 安装</h3><pre class=" language-shell"><code class="language-shell">sudo rpm -ivh http://nginx.org/packages/centos/7/noarch/RPMS/nginx-release-centos-7-0.el7.ngx.noarch.rpm# 查看sudo yum repolist | grep nginxsudo yum -y install nginx##### 如果是 centos 8，  可以直接安装！！！sudo yum install nginx</code></pre><h3 id="2-配置"><a href="#2-配置" class="headerlink" title="2. 配置"></a>2. 配置</h3><p>设置开机自启动、启动 nginx</p><pre class=" language-shell"><code class="language-shell"># 开机自启动sudo systemctl enable nginx# 启动服务sudo systemctl start nginx# 重启服务sudo systemctl reload nginx# 停止服务sudo systemctl stop nginx</code></pre><h2 id="PostgreSQL-12"><a href="#PostgreSQL-12" class="headerlink" title="PostgreSQL 12"></a>PostgreSQL 12</h2><p><a href="https://www.postgresql.org/download/linux/redhat/" target="_blank" rel="noopener">https://www.postgresql.org/download/linux/redhat/</a></p><h3 id="1-安装-pg12-rpm"><a href="#1-安装-pg12-rpm" class="headerlink" title="1. 安装 pg12 rpm"></a>1. 安装 pg12 rpm</h3><p>这里需要注意的是，需要根据具体的版本来确定 rpm 源</p><p>我安装时，ceotos 版本是 7-x86_64 的</p><pre class=" language-bash"><code class="language-bash">yum <span class="token function">install</span> https://download.postgresql.org/pub/repos/yum/reporpms/EL-7-x86_64/pgdg-redhat-repo-latest.noarch.rpm</code></pre><h3 id="2-安装客户端和服务端"><a href="#2-安装客户端和服务端" class="headerlink" title="2. 安装客户端和服务端"></a>2. 安装客户端和服务端</h3><pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># client</span>yum <span class="token function">install</span> postgresql12<span class="token comment" spellcheck="true"># 服务端</span>yum <span class="token function">install</span> postgresql12-server</code></pre><h3 id="配置开机自启动等操作-Optional"><a href="#配置开机自启动等操作-Optional" class="headerlink" title="配置开机自启动等操作(Optional)"></a>配置开机自启动等操作(Optional)</h3><pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 初始化 pgdb</span>/usr/pgsql-12/bin/postgresql-12-setup initdb<span class="token comment" spellcheck="true"># 设置开机自启动</span>systemctl <span class="token function">enable</span> postgresql-12<span class="token comment" spellcheck="true"># 开启 pgdb</span>systemctl start postgresql-12</code></pre><h3 id="初始账号密码及修改"><a href="#初始账号密码及修改" class="headerlink" title="初始账号密码及修改"></a>初始账号密码及修改</h3><p>postgres/postgres</p><p>修改配置前会遇到的问题及解答</p><ul><li><a href="https://serverfault.com/questions/406606/postgres-error-message-fatal-ident-authentication-failed-for-user" target="_blank" rel="noopener">https://serverfault.com/questions/406606/postgres-error-message-fatal-ident-authentication-failed-for-user</a></li><li><a href="https://stackoverflow.com/questions/2942485/psql-fatal-ident-authentication-failed-for-user-postgres" target="_blank" rel="noopener">https://stackoverflow.com/questions/2942485/psql-fatal-ident-authentication-failed-for-user-postgres</a></li></ul><p>可以通过修改配置完成：</p><p>vim /var/lib/pgsql/12/data/pg_hba.conf</p><pre><code># TYPE  DATABASE        USER            ADDRESS                 METHOD# "local" is for Unix domain socket connections onlylocal   all             all                                     peer# IPv4 local connections:# old line -- dylan#host    all             all             127.0.0.1/32            ident# new line -- dylanhost    all             all             127.0.0.1/32            trusthost    all             all             all                     md5# IPv6 local connections:# old line -- dylan# host    all             all             ::1/128                 ident# Allow replication connections from localhost, by a user with the# replication privilege.# old lines -- dylan#local   replication     all                                     peer#host    replication     all             127.0.0.1/32            ident#host    replication     all             ::1/128                 ident# new lines -- dylanhost    replication     all             127.0.0.1/32            trusthost    replication     all             all                     md5</code></pre><p>vim /var/lib/pgsql/12/data/postgresql.conf</p><pre><code># - Connection Settings -# -- new line start -- dylanlisten_addresses = '*'# -- new line end -- dylan#listen_addresses = 'localhost'         # what IP address(es) to listen on;</code></pre><h3 id="远程连接"><a href="#远程连接" class="headerlink" title="远程连接"></a>远程连接</h3><p>通过安装 pgAdmin4 连接</p><h2 id="Java-Install"><a href="#Java-Install" class="headerlink" title="Java Install"></a>Java Install</h2><h3 id="Java-8"><a href="#Java-8" class="headerlink" title="Java 8"></a>Java 8</h3><pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 安装后 java &amp; javac 都能正常使用</span><span class="token function">sudo</span> yum <span class="token function">install</span> -y java-1.8.0-openjdk-devel.x86_64<span class="token comment" spellcheck="true"># 安装后只有 java 能正常使用， javac 无用</span><span class="token function">sudo</span> yum <span class="token function">install</span> -y java-1.8.0-openjdk.x86_64</code></pre><h3 id="Java-11"><a href="#Java-11" class="headerlink" title="Java 11"></a>Java 11</h3><p>系统为 centOS 8， 其他系统未验证(如果失败，可以通过源码安装，配置环境变量)</p><p><code>sudo yum install java-11-openjdk-devel</code> </p><h2 id="Golang-Install"><a href="#Golang-Install" class="headerlink" title="Golang Install"></a>Golang Install</h2><h3 id="Golang-官方安装文档"><a href="#Golang-官方安装文档" class="headerlink" title="Golang 官方安装文档"></a><a href="https://golang.google.cn/doc/install?download=go1.13.9.linux-amd64.tar.gz" target="_blank" rel="noopener">Golang 官方安装文档</a></h3><p>如果有老版本，参考  <a href="https://golang.google.cn/doc/install?download=go1.13.9.linux-amd64.tar.gz#uninstall" target="_blank" rel="noopener">remove old golang</a> 先删除掉</p><h3 id="Glang-1-13-Install"><a href="#Glang-1-13-Install" class="headerlink" title="Glang 1.13 Install"></a>Glang 1.13 Install</h3><pre class=" language-shell"><code class="language-shell"># 1. 下载curl -o https://dl.google.com/go/go1.13.9.linux-amd64.tar.gz# 解压sudo tar -C /usr/local go1.13.9.linux-amd64.tar.gz# path## 1. 在 .bash_profile 中最后位置添加  export PATH=$PATH:/usr/local/go/bin (针对当前用户)## 2. 保存后执行 source ~/.bash_profile## 3. 如果使用的是 zsh ， 需要在 ~/.zshrc 中配置  source ~/.bash_profile## 或者直接在 /etc/profile 中配置， 在最末尾的位置追加 export PATH=$PATH:/usr/local/go/bin 即可(针对所有用户)</code></pre><h3 id="Golang-1-12-Install"><a href="#Golang-1-12-Install" class="headerlink" title="Golang 1.12 Install"></a>Golang 1.12 Install</h3><p>如果你只想安装 1.12 (目前 yum 源还没有 1.13)，可以直接通过 yum 安装</p><p><code>sudo yum -y install golang</code></p><h2 id="VIM"><a href="#VIM" class="headerlink" title="VIM"></a>VIM</h2><p>用 vim 有一两年的历史，虽然现在只会一些常用的命令，各种骚操作基本不会，但在 Terminal 端操作时，还是能带来不少的便利。</p><p>常用的 vim plugin 管理工具，有 vundle 和 vim-plug</p><h3 id="0-卸载你的-vim-管理工具"><a href="#0-卸载你的-vim-管理工具" class="headerlink" title="0. 卸载你的 vim 管理工具"></a>0. 卸载你的 vim 管理工具</h3><pre class=" language-bash"><code class="language-bash"><span class="token function">rm</span> -rf ~/.vim<span class="token comment" spellcheck="true"># 在此之前， 你可能需要先备份你的 .vimrc 文件,如 cp .vimrm vimrm</span><span class="token function">rm</span> .vimrc</code></pre><h3 id="1-通过-vundle-管理-vim-plugin"><a href="#1-通过-vundle-管理-vim-plugin" class="headerlink" title="1. 通过 vundle 管理 vim plugin"></a>1. 通过 vundle 管理 vim plugin</h3><ul><li>通过 <a href="https://github.com/VundleVim/Vundle.vim" target="_blank" rel="noopener">Vundle GitHub</a> 中的步骤安装</li><li>如果没有 <code>.vimrc</code> ，直接创建即可。</li><li>在 <code>call vundle#begin()</code> 和 <code>call vundle#end()</code> 之间添加你需要的 vim plugin</li><li>在最后添加各种插件的配置</li><li>一个示例： <a href="https://gitee.com/dylan0011/codes/uoe5cm1s2j4nxkvtydh9814" target="_blank" rel="noopener">vundle example</a></li></ul><h3 id="2-通过-vim-plug-管理-vim-plugin"><a href="#2-通过-vim-plug-管理-vim-plugin" class="headerlink" title="2. 通过 vim-plug 管理 vim plugin"></a>2. 通过 vim-plug 管理 vim plugin</h3><p>可参考文章 <a href="https://vimjc.com/vim-plug.html" target="_blank" rel="noopener">vim-plug</a></p><ul><li><p>通过 <a href="https://github.com/junegunn/vim-plug" target="_blank" rel="noopener">Vim-plug Github</a> 中的步骤安装</p></li><li><p>一个示例： <a href="https://gitee.com/dylan0011/codes/2owi5379ep6zymrcsj08q46" target="_blank" rel="noopener">vim-plug example</a></p></li></ul><h3 id="4-vim-设置快捷键时候的坑"><a href="#4-vim-设置快捷键时候的坑" class="headerlink" title="4. vim 设置快捷键时候的坑"></a>4. vim 设置快捷键时候的坑</h3><h4 id="1-设置快捷键的时候，-比如设置为-A-m-即-Alt-m-键，可一直不起作用！！！遂放弃-Alt-。"><a href="#1-设置快捷键的时候，-比如设置为-A-m-即-Alt-m-键，可一直不起作用！！！遂放弃-Alt-。" class="headerlink" title="1. 设置快捷键的时候， 比如设置为 A-m , 即 Alt + m 键，可一直不起作用！！！遂放弃 Alt 。"></a>1. 设置快捷键的时候， 比如设置为 <em>A-m</em> , 即 Alt + m 键，可一直不起作用！！！遂放弃 Alt 。</h4><p><a href="https://vi.stackexchange.com/questions/2350/how-to-map-alt-key" target="_blank" rel="noopener">这里</a> 告诉你为什么</p><p>各种 Shift/Ctrl/Alt 对应如下：</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://img.iyuhp.top/blog/20200401100954.png-growing" alt="vim keymap"></p><h4 id="2-YCM-需要-cmake"><a href="#2-YCM-需要-cmake" class="headerlink" title="2. YCM 需要 cmake"></a>2. YCM 需要 cmake</h4><p><a href="https://github.com/ycm-core/YouCompleteMe#installation" target="_blank" rel="noopener">YCM 官方安装指南</a></p><p><a href="https://linux4one.com/how-to-install-cmake-on-centos-8/" target="_blank" rel="noopener">cmake 安装指南</a></p><p>我是 centos 8， 通过 <code>yum info cmake</code> 看到 cmake 版本是 3.11.4 ， 所以直接通过 yum 安装了。 同时要保证已经安装了 gcc ( <code>sudo dnfinstall -y gcc-c++</code> )</p><h4 id="3-tagbar"><a href="#3-tagbar" class="headerlink" title="3. tagbar"></a>3. tagbar</h4><p>安装之前，要先安装 ctags： <code>sudo yum install -y ctags</code> </p><h2 id="小脚本"><a href="#小脚本" class="headerlink" title="小脚本"></a>小脚本</h2><pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true">#!/usr/bin/env bash</span><span class="token keyword">set</span> -eo pipefailcommand<span class="token operator">=</span><span class="token variable">$1</span>param1<span class="token operator">=</span><span class="token variable">$2</span><span class="token keyword">function</span> git_install<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    yum -y update \     <span class="token operator">&amp;&amp;</span> yum -y <span class="token function">install</span> <span class="token function">git</span><span class="token punctuation">}</span><span class="token keyword">function</span> zsh_install<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    git_install    yum -y <span class="token function">install</span> zsh<span class="token punctuation">}</span><span class="token keyword">function</span> oh_my_zsh_install<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    zsh_install   sh -c <span class="token string">"<span class="token variable"><span class="token variable">$(</span>curl -fsSL https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh<span class="token variable">)</span></span>"</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true"># install powerline if necessary</span><span class="token keyword">function</span> powerline_install<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>   <span class="token function">git</span> clone https://github.com/powerline/fonts.git --depth<span class="token operator">=</span>1 \   <span class="token operator">&amp;&amp;</span> <span class="token function">cd</span> fonts \   <span class="token operator">&amp;&amp;</span> ./install.sh \   <span class="token operator">&amp;&amp;</span> <span class="token function">cd</span> <span class="token punctuation">..</span> \   <span class="token operator">&amp;&amp;</span> <span class="token function">rm</span> -fr ./fonts<span class="token punctuation">}</span><span class="token comment" spellcheck="true"># add user</span><span class="token keyword">function</span> add_user<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> -z <span class="token variable">${param1}</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>       param1<span class="token operator">=</span><span class="token string">"dylan"</span>    <span class="token keyword">fi</span>    adduser <span class="token variable">${param1}</span>    <span class="token function">passwd</span> <span class="token variable">${param1}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">## generate ssh</span><span class="token keyword">function</span> generate_ssh<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    ssh-keygen -t rsa -C <span class="token string">"peifeng"</span>    <span class="token function">touch</span> <span class="token variable">$HOME</span>/.ssh/config<span class="token punctuation">}</span><span class="token keyword">function</span> docker_install<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>yum remove -y docker docker-common docker-selinux docker-engine \<span class="token operator">&amp;&amp;</span> yum <span class="token function">install</span> -y yum-utils device-mapper-persistent-data lvm2 \<span class="token operator">&amp;&amp;</span> yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo \<span class="token operator">&amp;&amp;</span> yum makecache fast \<span class="token operator">&amp;&amp;</span> yum -y <span class="token function">install</span> docker-ce<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> -z <span class="token variable">${param1}</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>    param1<span class="token operator">=</span><span class="token string">"https://docker.mirrors.ustc.edu.cn"</span><span class="token keyword">fi</span><span class="token function">cat</span> <span class="token operator">></span> /etc/docker/daemon.json <span class="token operator">&lt;&lt;</span><span class="token string">EOF{  "registry-mirrors": ["<span class="token variable">${param1}</span>"]  "exec-opts": ["native.cgroupdriver=systemd"],  "log-driver": "json-file",  "log-opts": {    "max-size": "100m"  },  "storage-driver": "overlay2",  "storage-opts": [    "overlay2.override_kernel_check=true"  ]}EOF</span>systemctl start dockersystemctl <span class="token function">enable</span> docker<span class="token punctuation">}</span><span class="token keyword">function</span> add_user_to_docker_group<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    gpasswd -a <span class="token variable">${USER}</span> docker    newgrp docker<span class="token punctuation">}</span><span class="token keyword">function</span> java_install<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>   yum <span class="token function">install</span> -y java-1.8.0-openjdk-devel.x86_64<span class="token punctuation">}</span><span class="token keyword">function</span> maven_install<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">wget</span> http://mirrors.tuna.tsinghua.edu.cn/apache/maven/maven-3/3.6.1/binaries/apache-maven-3.6.1-bin.tar.gz    <span class="token function">tar</span> -zxvf apache-maven-3.6.1-bin.tar.gz    <span class="token function">sudo</span> <span class="token function">mv</span> ./apache-maven-3.6.1 /usr/share/    <span class="token keyword">echo</span> <span class="token string">"export PATH=<span class="token variable">$PATH</span>:/usr/share/apache-maven-3.6.1/bin"</span> <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> -a /etc/profile    <span class="token function">source</span> /etc/profile    mvn --version<span class="token punctuation">}</span><span class="token keyword">function</span> main<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    usage<span class="token operator">=</span><span class="token string">"Usage: <span class="token variable">$0</span> (all|zsh|docker|java|maven)"</span>    <span class="token keyword">echo</span> <span class="token variable">${usage}</span>    <span class="token keyword">case</span> <span class="token variable">${command}</span> <span class="token keyword">in</span>    all<span class="token punctuation">)</span>         oh_my_zsh_install         powerline_install         generate_ssh         add_user         docker_install         add_user_to_docker_group         java_install    <span class="token punctuation">;</span><span class="token punctuation">;</span>    zsh<span class="token punctuation">)</span>        oh_my_zsh_install    <span class="token punctuation">;</span><span class="token punctuation">;</span>    docker<span class="token punctuation">)</span>        docker_install    <span class="token punctuation">;</span><span class="token punctuation">;</span>    java<span class="token punctuation">)</span>        java_install    <span class="token punctuation">;</span><span class="token punctuation">;</span>    maven<span class="token punctuation">)</span>        maven_install     <span class="token punctuation">;</span><span class="token punctuation">;</span>    *<span class="token punctuation">)</span>        <span class="token keyword">echo</span> <span class="token string">"unsupported command yet"</span>        <span class="token keyword">exit</span> 0    <span class="token punctuation">;</span><span class="token punctuation">;</span>    esac<span class="token punctuation">}</span>main</code></pre><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JAVA 排查姿势简介</title>
      <link href="/tools/greys/"/>
      <url>/tools/greys/</url>
      
        <content type="html"><![CDATA[<h1 id="java-排查姿势简介"><a href="#java-排查姿势简介" class="headerlink" title="java 排查姿势简介"></a>java 排查姿势简介</h1><h2 id="Greys-anatomy"><a href="#Greys-anatomy" class="headerlink" title="Greys-anatomy"></a>Greys-anatomy</h2><p><a href="https://github.com/oldmanpushcart/greys-anatomy" target="_blank" rel="noopener">greys-anatomy</a> 是一款很优秀的 java 诊断工具， 由阿里的一位工程师开发维护，并开源到 github 上。</p><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>github 上的文档说明的很详细了， 而且是中文文档， 阅读基本无障碍。linux 环境， 通过</p><pre class=" language-bash"><code class="language-bash">curl -sLk http://ompc.oss.aliyuncs.com/greys/install.sh<span class="token operator">|</span>sh</code></pre><p>或者短链接</p><pre class=" language-bash"><code class="language-bash">curl -sLk http://t.cn/R2QbHFc<span class="token operator">|</span>sh</code></pre><p>安装即可</p><h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><ol><li>在 linux 环境下， 首先需要设置 <code>JAVA_HOME</code>  路径，不过一般都设置过。修改 /etc/profile 文件， 或者修改 .bashrc 文件， 当然， 我们可能没有权限，此时可以通过 export JAVA_HOME=/xxx 来临时设置该变量</li><li>通过 <code>jps</code> 命令来查找需要诊断的 java 程序对应的 pid</li><li>通过 <code>./greys pid</code> 来运行格雷医生</li><li>好了， 至此， 你就能通过提供的 <a href="https://github.com/oldmanpushcart/greys-anatomy/wiki/greys-pdf" target="_blank" rel="noopener">文档</a> ， 来查找定位你的 java 问题了。</li></ol><h3 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h3><h4 id="watch"><a href="#watch" class="headerlink" title="watch"></a>watch</h4><p>该命令能监控指定方法的入参，出参数据</p><blockquote><p>watch -b com.xxx.xxx.xxx helloWorld ‘“params[0]=”+params[0]’;<br>watch -s com.xxx.xxx.xxx helloWorld returnObj -x 3;</p></blockquote><h4 id="trace"><a href="#trace" class="headerlink" title="trace"></a>trace</h4><p>该命令能追踪一级方法的调用链路， 同时打印出对应方法的耗时， 可以用来做性能分析</p><blockquote><p>trace com.xxx.xxx.xxx helloWorld</p></blockquote><h4 id="ptrace"><a href="#ptrace" class="headerlink" title="ptrace"></a>ptrace</h4><p>是 <code>trace</code> 命令的增强版， 具体请参见 <a href="https://github.com/oldmanpushcart/greys-anatomy/wiki/greys-pdf#ptrace%E5%91%BD%E4%BB%A4" target="_blank" rel="noopener">github</a></p><h4 id="tt"><a href="#tt" class="headerlink" title="tt"></a>tt</h4><p>TimeTunnel 时间隧道。 该命令很强大， 能记录指定方法的所有入参，出参和抛出的异常。</p><p>通过 <code>-i index</code> 可以查看具体 index 的详细信息</p><p>通过 <code>-i index -p</code> 来自主发起调用</p><p>具体请参见 <a href="https://github.com/oldmanpushcart/greys-anatomy/wiki/greys-pdf#tt%E5%91%BD%E4%BB%A4" target="_blank" rel="noopener">github</a></p><h4 id="others"><a href="#others" class="headerlink" title="others"></a>others</h4><ul><li>stack</li><li>sc</li><li>sm</li><li>monitor</li><li>reset</li><li>…..</li></ul><h2 id="Arthas"><a href="#Arthas" class="headerlink" title="Arthas"></a>Arthas</h2><p>链接 <a href="https://github.com/alibaba/arthas" target="_blank" rel="noopener">https://github.com/alibaba/arthas</a></p><h2 id="线上-debug"><a href="#线上-debug" class="headerlink" title="线上 debug"></a>线上 debug</h2><p>我本地跑的好好的， 怎么到了线上就出了各种问题了？？？</p><p>莫慌， 远程 debug 来助你找到元凶。</p><p>这里选择 <code>IDEA</code> 编译器来演示， <code>Eclips</code> 可自行 Google 使用办法。</p><h3 id="线上-java-服务配置"><a href="#线上-java-服务配置" class="headerlink" title="线上 java 服务配置"></a>线上 java 服务配置</h3><p>在 java 程序启动的时候， 添加如下启动参数(该配置只针对 jdk5-8 的版本)</p><blockquote><p><code>-agentlib:jdwp=transport=dt_socket,server=y,address=8888,suspend=n</code>  </p></blockquote><ul><li>jdwp: java debug wire protocol 自定义的一套远程 debug 协议</li><li>transport=dt_socket 通过 socket 传输</li><li>server=y  server 端监听将要连接的 debug client，否则，将连接到特定地址上的 debug client。</li><li>suspend=n  告知 jvm 立即执行， 无需等待 debug client 连接(设置为 y 时， 会等待链接)</li><li>address=8888  debug 调试端口(有时连接不上， 可能服务端所在宿主机的端口没开)</li></ul><p>对于区分不同环境的启动脚本而言， 只需要定义 JAVA_OPTS 变量， 在开发环境(一般测试和生产不可随意添加这种启动参数)启动时， 加上该变量即可。<br>同时要注意，配置的端口号，server 端是否有开放，一般情况下，server 端的端口都是有限开放。所以配置前要确认端口是否开放。</p><h3 id="IDEA-配置"><a href="#IDEA-配置" class="headerlink" title="IDEA 配置"></a>IDEA 配置</h3><p>在 idea 上找到 edit configurations</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://img.iyuhp.top/blog/20200401091235.png-growing" alt="idea configurations"></p><p>在左侧菜单找到 remote 选项，填写相关内容(host 为 server 端 host， port 为上文中 address 对应的端口值)</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://img.iyuhp.top/blog/20200401091320.png-growing" alt="remote debug configuration"></p><p>配置完毕， 启动服务，即可愉快的开始 remote debug 了。</p><p>这里需要注意的一点，如果有多线程程序需要调试， 你需要把断点类型设置为 Thread。</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://img.iyuhp.top/blog/20200401091429.png-growing" alt="Thread"></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tools </tag>
            
            <tag> java </tag>
            
            <tag> 运维 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
